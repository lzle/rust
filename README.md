## ç›®å½•

* [å…¥é—¨](#å…¥é—¨)
    * [å®‰è£…](#å®‰è£…)
    * [VSCode](#VSCode)
    * [Cargo](#Cargo)
* [æ•°æ®ç±»å‹](#æ•°æ®ç±»å‹)
    * [æ•´å‹](#æ•´å‹int)
    * [æµ®ç‚¹ç±»å‹](#æµ®ç‚¹ç±»å‹float)
    * [å­—ç¬¦](#å­—ç¬¦char)
    * [å¸ƒå°”](#å¸ƒå°”bool)
    * [å…ƒç»„](#å…ƒç»„tuple)
    * [æŒ‡é’ˆ](#æŒ‡é’ˆ)
    * [æ•°ç»„](#æ•°ç»„)
    * [vector](#vector)
    * [åˆ‡ç‰‡](#åˆ‡ç‰‡)
    * [å­—ç¬¦ä¸²](#å­—ç¬¦ä¸²)
* [è¿ç®—](#è¿ç®—)
    * [æ•°å­—è¿ç®—](#æ•°å­—è¿ç®—)
    * [ä½è¿ç®—](#ä½è¿ç®—)
* [æ‰€æœ‰æƒå’Œç§»åŠ¨](#æ‰€æœ‰æƒå’Œç§»åŠ¨)
    * [æ‰€æœ‰æƒ](#æ‰€æœ‰æƒ)
    * [ç§»åŠ¨](#ç§»åŠ¨)
    * [Copy ç±»å‹](#copy-ç±»å‹)
    * [Rc å’Œ Arc](#rc-å’Œ-arcå…±äº«æ‰€æœ‰æƒ)
* [å¼•ç”¨](#å¼•ç”¨)
    * [å¼•ç”¨](#å¼•ç”¨)
* [ç”Ÿå‘½å‘¨æœŸ](#ç”Ÿå‘½å‘¨æœŸ)
    * [å¼•ç”¨](#ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨)
* [ç‰¹å‹å’Œæ³›å‹](#ç‰¹å‹å’Œæ³›å‹)
    * [ä½¿ç”¨ç‰¹å‹](#ä½¿ç”¨ç‰¹å‹)


## å…¥é—¨

### å®‰è£…

`rustup` æ˜¯ Rust çš„å®‰è£…ç¨‹åºï¼Œä¹Ÿæ˜¯å®ƒçš„ç‰ˆæœ¬ç®¡ç†ç¨‹åºï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨ `rustup` æ¥å®‰è£… Rustã€‚ å¦‚æœä½ ä¸æƒ³ç”¨æˆ–è€…ä¸èƒ½ç”¨ `rustup`ï¼Œè¯·å‚è§[Rust å…¶ä»–å®‰è£…æ–¹å¼](https://forge.rust-lang.org/infra/other-installation-methods.html#other-rust-installation-methods)ã€‚

æ‰“å¼€ç»ˆç«¯å¹¶è¾“å…¥ä¸‹é¢å‘½ä»¤ï¼ˆLinux & macOSï¼‰:

```bash
$ curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSf | sh
```

è¿™ä¸ªå‘½ä»¤å°†ä¸‹è½½ä¸€ä¸ªè„šæœ¬å¹¶å¼€å§‹å®‰è£… `rustup` å·¥å…·ï¼Œæ­¤å·¥å…·å°†å®‰è£… Rust çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ã€‚å¯èƒ½ä¼šæç¤ºä½ è¾“å…¥ç®¡ç†å‘˜å¯†ç ã€‚

å¦‚æœå®‰è£…æˆåŠŸï¼Œå°†å‡ºç°ä¸‹é¢è¿™è¡Œ:

```bash
Rust is installed now. Great!
```

OKï¼Œè¿™æ ·å°±å·²ç»å®Œæˆ Rust å®‰è£…å•¦ã€‚

æ£€æŸ¥æ˜¯å¦æ­£ç¡®å®‰è£…äº† Rustï¼Œå¯æ‰“å¼€ç»ˆç«¯å¹¶è¾“å…¥ä¸‹é¢è¿™è¡Œï¼Œæ­¤æ—¶èƒ½çœ‹åˆ°æœ€æ–°å‘å¸ƒçš„ç¨³å®šç‰ˆæœ¬çš„ç‰ˆæœ¬å·ã€æäº¤å“ˆå¸Œå€¼å’Œæäº¤æ—¥æœŸ:

```bash
$ rustc -V
rustc 1.81.0 (eeb90cda1 2024-09-04)

$ cargo -V
cargo 1.81.0 (2dbb1af80 2024-08-20)
```

### æ›´æ–°

è¦æ›´æ–° Rustï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯æ›´æ–°ï¼š

```bash
$ rustup update
```

### å¸è½½

è¦å¸è½½ Rust å’Œ `rustup`ï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯å¸è½½ï¼š

```bash
$ rustup self uninstall
```

### VSCode

[å¢™æ¨ VSCode æ’ä»¶](https://course.rs/first-try/editor.html)

### Cargo

`cargo` æä¾›äº†ä¸€ç³»åˆ—çš„å·¥å…·ï¼Œä»é¡¹ç›®çš„å»ºç«‹ã€æ„å»ºåˆ°æµ‹è¯•ã€è¿è¡Œç›´è‡³éƒ¨ç½²ï¼Œä¸º Rust é¡¹ç›®çš„ç®¡ç†æä¾›å°½å¯èƒ½å®Œæ•´çš„æ‰‹æ®µ

åŒ…ç®¡ç†å·¥å…·æœ€é‡è¦çš„æ„ä¹‰å°±æ˜¯ä»»ä½•ç”¨æˆ·æ‹¿åˆ°ä½ çš„ä»£ç ï¼Œéƒ½èƒ½è¿è¡Œèµ·æ¥ï¼Œè€Œä¸ä¼šå› ä¸ºå„ç§åŒ…ç‰ˆæœ¬ä¾èµ–ç„¦å¤´çƒ‚é¢ã€‚

åˆ›å»ºä¸€ä¸ªæ–°çš„ Rust é¡¹ç›®:

```bash
$ cargo new hello_cargo
```

ä¸Šé¢çš„å‘½ä»¤ä½¿ç”¨ `cargo new` åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œé¡¹ç›®åæ˜¯ `hello_cargo` ï¼Œè¯¥é¡¹ç›®çš„ç»“æ„å’Œé…ç½®æ–‡ä»¶éƒ½æ˜¯ç”± `cargo` ç”Ÿæˆï¼Œæ„å‘³ç€æˆ‘ä»¬çš„é¡¹ç›®è¢« `cargo` æ‰€ç®¡ç†ã€‚

ä¸‹é¢æ¥çœ‹çœ‹åˆ›å»ºçš„é¡¹ç›®ç»“æ„:

```bash
$ tree
.
â”œâ”€â”€ .git
â”œâ”€â”€ .gitignore
â”œâ”€â”€ Cargo.toml
â””â”€â”€ src
    â””â”€â”€ main.rs
```

#### è¿è¡Œé¡¹ç›®

æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è¿è¡Œé¡¹ç›®ï¼š

* cargo run

* æ‰‹åŠ¨ç¼–è¯‘å’Œè¿è¡Œé¡¹ç›®

é¦–å…ˆæ¥çœ‹çœ‹ç¬¬ä¸€ç§æ–¹å¼ `cargo run` å‘½ä»¤ä¼šç¼–è¯‘å¹¶è¿è¡Œé¡¹ç›®ã€‚

```bash
$ cargo run
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.01s
     Running `target/debug/hello_cargo`
Hello, world!
```

æ‰‹åŠ¨ç¼–è¯‘å’Œè¿è¡Œé¡¹ç›®ã€‚

ç¼–è¯‘

```
$ cargo build
    Finished dev [unoptimized + debuginfo] target(s) in 0.00s
```

è¿è¡Œ

```
$ ./target/debug/hello_cargo
Hello, world!
```

ä¸Šé¢ä»£ç è¿è¡Œåœ¨ `debug` æ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œä»£ç çš„ç¼–è¯‘é€Ÿåº¦ä¼šéå¸¸å¿«ï¼Œå¯æ˜¯ç¦å…®ç¥¸æ‰€ä¼ï¼Œè¿è¡Œé€Ÿåº¦å°±æ…¢äº†. åŸå› æ˜¯ï¼Œåœ¨ `debug` æ¨¡å¼ä¸‹ï¼ŒRust ç¼–è¯‘å™¨ä¸ä¼šåšä»»ä½•çš„ä¼˜åŒ–ï¼Œåªä¸ºäº†å°½å¿«çš„ç¼–è¯‘å®Œæˆï¼Œè®©ä½ çš„å¼€å‘æµç¨‹æ›´åŠ é¡ºç•…ã€‚

å¦‚æœæƒ³è¦åœ¨ `release` æ¨¡å¼ä¸‹è¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨ `--release` å‚æ•°ï¼š

```
$ cargo run --release
$ cargo build --release
$ ./target/release/hello_cargo
Hello, world!
```

#### Cargo Check

å½“é¡¹ç›®å¤§äº†åï¼Œ`cargo run` å’Œ `cargo build` ä¸å¯é¿å…çš„ä¼šå˜æ…¢ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¿«çš„æ–¹å¼æ¥éªŒè¯ä»£ç çš„æ­£ç¡®æ€§å‘¢ï¼Ÿå¤§æ€å™¨æ¥äº†ï¼Œæ¥ç€ï¼

`cargo check` æ˜¯æˆ‘ä»¬åœ¨ä»£ç å¼€å‘è¿‡ç¨‹ä¸­æœ€å¸¸ç”¨çš„å‘½ä»¤ï¼Œå®ƒçš„ä½œç”¨å¾ˆç®€å•ï¼šå¿«é€Ÿçš„æ£€æŸ¥ä¸€ä¸‹ä»£ç èƒ½å¦ç¼–è¯‘é€šè¿‡ã€‚å› æ­¤è¯¥å‘½ä»¤é€Ÿåº¦ä¼šéå¸¸å¿«ï¼Œèƒ½èŠ‚çœå¤§é‡çš„ç¼–è¯‘æ—¶é—´ã€‚

```bash
$ cargo check
    Checking world_hello v0.1.0 (/Users/sunfei/development/rust/world_hello)
    Finished dev [unoptimized + debuginfo] target(s) in 0.06s
```

#### Cargo.toml å’Œ Cargo.lock

`Cargo.toml` å’Œ `Cargo.lock` æ˜¯ `cargo` çš„æ ¸å¿ƒæ–‡ä»¶ï¼Œå®ƒçš„æ‰€æœ‰æ´»åŠ¨å‡åŸºäºæ­¤äºŒè€…ã€‚

* `Cargo.toml` æ˜¯ `cargo` ç‰¹æœ‰çš„é¡¹ç›®æ•°æ®æè¿°æ–‡ä»¶ã€‚å®ƒå­˜å‚¨äº†é¡¹ç›®çš„æ‰€æœ‰å…ƒé…ç½®ä¿¡æ¯ï¼Œå¦‚æœ Rust å¼€å‘è€…å¸Œæœ› Rust é¡¹ç›®èƒ½å¤ŸæŒ‰ç…§æœŸæœ›çš„æ–¹å¼è¿›è¡Œæ„å»ºã€æµ‹è¯•å’Œè¿è¡Œï¼Œé‚£ä¹ˆï¼Œå¿…é¡»æŒ‰ç…§åˆç†çš„æ–¹å¼æ„å»º `Cargo.toml`ã€‚

* `Cargo.lock` æ–‡ä»¶æ˜¯ `cargo` å·¥å…·æ ¹æ®åŒä¸€é¡¹ç›®çš„ toml æ–‡ä»¶ç”Ÿæˆçš„é¡¹ç›®ä¾èµ–è¯¦ç»†æ¸…å•ï¼Œå› æ­¤æˆ‘ä»¬ä¸€èˆ¬ä¸ç”¨ä¿®æ”¹å®ƒï¼Œåªéœ€è¦å¯¹ç€ `Cargo.toml` æ–‡ä»¶æ’¸å°±è¡Œäº†ã€‚

```
ä»€ä¹ˆæƒ…å†µä¸‹è¯¥æŠŠ `Cargo.lock` ä¸Šä¼ åˆ° git ä»“åº“é‡Œï¼Ÿå¾ˆç®€å•ï¼Œå½“ä½ çš„é¡¹ç›®æ˜¯ä¸€ä¸ªå¯è¿è¡Œçš„ç¨‹åºæ—¶ï¼Œå°±ä¸Šä¼  `Cargo.lock`ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªä¾èµ–åº“é¡¹ç›®ï¼Œé‚£ä¹ˆè¯·æŠŠå®ƒæ·»åŠ åˆ° `.gitignore` ä¸­ã€‚
```

[é…ç½®è¯¦æƒ…](https://course.rs/first-try/cargo.html#package-%E9%85%8D%E7%BD%AE%E6%AE%B5%E8%90%BD)


## æ•°æ®ç±»å‹

### æ•´å‹(int)

**æ•´æ•°**æ˜¯æ²¡æœ‰å°æ•°éƒ¨åˆ†çš„æ•°å­—ã€‚ä¹‹å‰ä½¿ç”¨è¿‡çš„ `i32` ç±»å‹ï¼Œè¡¨ç¤ºæœ‰ç¬¦å·çš„ 32 ä½æ•´æ•°ï¼ˆ `i` æ˜¯è‹±æ–‡å•è¯ _integer_ çš„é¦–å­—æ¯ï¼Œä¸ä¹‹ç›¸åçš„æ˜¯ `u`ï¼Œä»£è¡¨æ— ç¬¦å· `unsigned` ç±»å‹ï¼‰ã€‚ä¸‹è¡¨æ˜¾ç¤ºäº† Rust ä¸­çš„å†…ç½®çš„æ•´æ•°ç±»å‹ï¼š

| é•¿åº¦       | æœ‰ç¬¦å·ç±»å‹ | æ— ç¬¦å·ç±»å‹ |
| ---------- | ---------- | ---------- |
| 8 ä½       | `i8`       | `u8`       |
| 16 ä½      | `i16`      | `u16`      |
| 32 ä½      | `i32`      | `u32`      |
| 64 ä½      | `i64`      | `u64`      |
| 128 ä½     | `i128`     | `u128`     |
| è§†æ¶æ„è€Œå®š  | `isize`    | `usize`    |

ç±»å‹å®šä¹‰çš„å½¢å¼ç»Ÿä¸€ä¸ºï¼š`æœ‰æ— ç¬¦å· + ç±»å‹å¤§å°(ä½æ•°)`ã€‚**æ— ç¬¦å·æ•°**è¡¨ç¤ºæ•°å­—åªèƒ½å–æ­£æ•°å’Œ 0ï¼Œè€Œ**æœ‰ç¬¦å·**åˆ™è¡¨ç¤ºæ•°å­—å¯ä»¥å–æ­£æ•°ã€è´Ÿæ•°è¿˜æœ‰ 0ã€‚å°±åƒåœ¨çº¸ä¸Šå†™æ•°å­—ä¸€æ ·ï¼šå½“è¦å¼ºè°ƒç¬¦å·æ—¶ï¼Œæœ‰ç¬¦å·æ•°å­—ä»¥[è¡¥ç ](https://en.wikipedia.org/wiki/Two%27s_complement)å½¢å¼å­˜å‚¨ã€‚

```
â€Œâ€Œè¡¥ç â€Œä¸»è¦æ˜¯èƒ½å¤Ÿè®©åŠ æ³•å™¨åŒæ—¶å¤„ç†åŠ æ³•å’Œå‡æ³•:

â€Œè¡¥ç â€Œæ˜¯â€Œè®¡ç®—æœºä¸­è¡¨ç¤ºæœ‰ç¬¦å·æ•°çš„ä¸€ç§æ–¹æ³•ï¼ŒåŒ…æ‹¬â€ŒåŸç ã€â€Œåç å’Œè¡¥ç ä¸‰ç§è¡¨ç¤ºæ–¹æ³•ã€‚åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œæ•°å€¼ä¸€å¾‹ç”¨è¡¥ç æ¥è¡¨ç¤ºå’Œå­˜å‚¨ã€‚
è¡¥ç å¯ä»¥å°†ç¬¦å·ä½å’Œæ•°å€¼åŸŸç»Ÿä¸€å¤„ç†ï¼ŒåŒæ—¶åŠ æ³•å’Œå‡æ³•ä¹Ÿå¯ä»¥ç»Ÿä¸€å¤„ç†ã€‚

â€Œæ­£æ•°çš„è¡¥ç â€Œï¼šæ­£æ•°çš„è¡¥ç å°±æ˜¯å…¶æœ¬èº«ï¼Œå³ç¬¦å·ä½ä¸º0ï¼Œå…¶ä½™ä½ä¸ºè¯¥æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºã€‚

â€Œè´Ÿæ•°çš„è¡¥ç â€Œï¼šè´Ÿæ•°çš„è¡¥ç æ˜¯é€šè¿‡å…¶åŸç è®¡ç®—å¾—åˆ°çš„ã€‚é¦–å…ˆï¼Œå°†åŸç çš„ç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™ä½å–åï¼ˆ0å˜1ï¼Œ1å˜0ï¼‰ï¼Œç„¶ååŠ  1ã€‚
ä¾‹å¦‚ï¼Œ-8çš„åŸç ä¸º10001000ï¼Œå…¶åç ä¸º11110111ï¼Œè¡¥ç ä¸º11111000ã€‚â€Œ

è¡¥ç ç³»ç»Ÿçš„æœ€å¤§ä¼˜ç‚¹æ˜¯å¯ä»¥åœ¨åŠ æ³•æˆ–å‡æ³•å¤„ç†ä¸­ï¼Œä¸éœ€å› ä¸ºæ•°å­—çš„æ­£è´Ÿè€Œä½¿ç”¨ä¸åŒçš„è®¡ç®—æ–¹å¼ã€‚åªè¦ä¸€ç§åŠ æ³•ç”µè·¯å°±å¯ä»¥å¤„ç†å„ç§æœ‰å·æ•°åŠ æ³•ï¼Œ
è€Œä¸”å‡æ³•å¯ä»¥ç”¨ä¸€ä¸ªæ•°åŠ ä¸Šå¦ä¸€ä¸ªæ•°çš„è¡¥ç æ¥è¡¨ç¤ºï¼Œå› æ­¤åªè¦æœ‰åŠ æ³•ç”µè·¯åŠè¡¥ç ç”µè·¯å³å¯å®Œæˆå„ç§æœ‰å·æ•°åŠ æ³•åŠå‡æ³•ï¼Œåœ¨ç”µè·¯è®¾è®¡ä¸Šç›¸å½“æ–¹ä¾¿ã€‚

è®¡ç®— 13 - 7:

åŸç ï¼š13 = 00001101ï¼Œ7 = 00000111
è¡¥ç ï¼š13 = 00001101ï¼Œ-7 = 11111001

  00001101   (13)
+ 11111001   (-7)
------------
  00000110   (ç»“æœä¸º6)
```

æ­¤å¤–ï¼Œ`isize` å’Œ `usize` ç±»å‹å–å†³äºç¨‹åºè¿è¡Œçš„è®¡ç®—æœº CPU ç±»å‹ï¼š è‹¥ CPU æ˜¯ 32 ä½çš„ï¼Œåˆ™è¿™ä¸¤ä¸ªç±»å‹æ˜¯ 32 ä½çš„ï¼ŒåŒç†ï¼Œè‹¥ CPU æ˜¯ 64 ä½ï¼Œé‚£ä¹ˆå®ƒä»¬åˆ™æ˜¯ 64 ä½ã€‚

æ•´å½¢å­—é¢é‡å¯ä»¥ç”¨ä¸‹è¡¨çš„å½¢å¼ä¹¦å†™ï¼š

| æ•°å­—å­—é¢é‡         | ç¤ºä¾‹          |
| ------------------ | ------------- |
| åè¿›åˆ¶             | `98_222`      |
| åå…­è¿›åˆ¶           | `0xff`        |
| å…«è¿›åˆ¶             | `0o77`        |
| äºŒè¿›åˆ¶             | `0b1111_0000` |
| å­—èŠ‚ (ä»…é™äº `u8`) | `b'A'`        |

Rust æ•´å‹é»˜è®¤ä½¿ç”¨ `i32`ï¼Œä¾‹å¦‚ `let i = 1`ï¼Œé‚£ `i` å°±æ˜¯ `i32` ç±»å‹ï¼Œå› æ­¤ä½ å¯ä»¥é¦–é€‰å®ƒï¼ŒåŒæ—¶è¯¥ç±»å‹ä¹Ÿå¾€å¾€æ˜¯æ€§èƒ½æœ€å¥½çš„ã€‚`isize` å’Œ `usize` çš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ç”¨ä½œé›†åˆçš„ç´¢å¼•ã€‚

Rust ä¼šä½¿ç”¨ `u8` ç±»å‹ä½œä¸ºå­—èŠ‚å€¼ï¼Œä¾‹å¦‚ä»äºŒè¿›åˆ¶æ–‡ä»¶æˆ–å¥—æ¥å­—ä¸­è¯»å–æ•°æ®æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ª u8 å€¼æ„æˆçš„æµã€‚`char` æ—¢ä¸æ˜¯ `u8` ä¹Ÿä¸æ˜¯ `u32`ï¼Œå°½ç®¡å®ƒç¡®å®æœ‰ 32 ä½é•¿ã€‚

å‰ç¼€ 0xã€0o å’Œ 0b åˆ†åˆ«è¡¨ç¤ºåå…­è¿›åˆ¶ã€å…«è¿›åˆ¶å’ŒäºŒè¿›åˆ¶å­—é¢é‡ã€‚å­—é¢é‡ `b'A'` ä¸ `65u8` ç­‰ä»·ï¼Œå› ä¸º ASCII å­—ç¬¦ A çš„å€¼æ˜¯ 65ã€‚

#### æ•´å‹æº¢å‡º

æ£€æµ‹ç®—æ³•

å›ç»•ç®—æ³•

é¥±å’Œç®—æ³•

æº¢å‡ºç®—æ³•

### æµ®ç‚¹ç±»å‹(float)

**æµ®ç‚¹ç±»å‹æ•°å­—** æ˜¯å¸¦æœ‰å°æ•°ç‚¹çš„æ•°å­—ï¼Œåœ¨ Rust ä¸­æµ®ç‚¹ç±»å‹æ•°å­—ä¹Ÿæœ‰ä¸¤ç§åŸºæœ¬ç±»å‹ï¼š `f32` å’Œ `f64`ï¼Œåˆ†åˆ«ä¸º 32 ä½å’Œ 64 ä½å¤§å°ã€‚é»˜è®¤æµ®ç‚¹ç±»å‹æ˜¯ `f64`ï¼Œåœ¨ç°ä»£çš„ CPU ä¸­å®ƒçš„é€Ÿåº¦ä¸ `f32` å‡ ä¹ç›¸åŒï¼Œä½†ç²¾åº¦æ›´é«˜ã€‚Rust çš„ f32 å’Œ f64 åˆ†åˆ«å¯¹åº” C å’Œ C++ ä»¥åŠ Java ä¸­çš„ float å’Œ double ç±»å‹ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªæ¼”ç¤ºæµ®ç‚¹æ•°çš„ç¤ºä¾‹ï¼š

```rust
fn main() {
    let x = 2.0; // f64
    let y: f32 = 3.0; // f32
}
```

æµ®ç‚¹æ•°æ ¹æ® `IEEE-754` æ ‡å‡†å®ç°ã€‚`f32` ç±»å‹æ˜¯å•ç²¾åº¦æµ®ç‚¹å‹ï¼Œ`f64` ä¸ºåŒç²¾åº¦ã€‚

#### æµ®ç‚¹æ•°é™·é˜±

æµ®ç‚¹æ•°ç”±äºåº•å±‚æ ¼å¼çš„ç‰¹æ®Šæ€§ï¼Œéœ€è¦æ³¨æ„ä¸‹é¢ä¸¤ç‚¹ï¼š

* æµ®ç‚¹æ•°å¾€å¾€æ˜¯ä½ æƒ³è¦æ•°å­—çš„è¿‘ä¼¼è¡¨è¾¾
* å¯ä»¥ä½¿ç”¨ `>`ï¼Œ`>=` ç­‰è¿›è¡Œæ¯”è¾ƒï¼Œä¸å¯ä»¥æµ‹è¯•ç›¸ç­‰æ€§

æµ®ç‚¹æ•°æœªå®ç° `std::cmp::Eq` ç‰¹å¾ï¼Œæ— æ³•ä½¿ç”¨æµ®ç‚¹æ•°ä½œä¸º `HashMap` çš„ `Key`ã€‚

æ¥çœ‹ä¸ªå°ä¾‹å­:

```rust
fn main() {
  // æ–­è¨€0.1 + 0.2ä¸0.3ç›¸ç­‰
  assert!(0.1 + 0.2 == 0.3);
}
```

ä½ å¯èƒ½ä»¥ä¸ºï¼Œè¿™æ®µä»£ç æ²¡å•¥é—®é¢˜å§ï¼Œå®é™…ä¸Šå®ƒä¼š _panic_ï¼ˆç¨‹åºå´©æºƒï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œå› ä¸ºäºŒè¿›åˆ¶ç²¾åº¦é—®é¢˜ï¼Œå¯¼è‡´äº† 0.1 + 0.2 å¹¶ä¸ä¸¥æ ¼ç­‰äº 0.3ï¼Œå®ƒä»¬å¯èƒ½åœ¨å°æ•°ç‚¹ N ä½åå­˜åœ¨è¯¯å·®ã€‚

é‚£å¦‚æœéè¦è¿›è¡Œæ¯”è¾ƒå‘¢ï¼Ÿå¯ä»¥è€ƒè™‘ç”¨è¿™ç§æ–¹å¼ `(0.1_f64 + 0.2 - 0.3).abs() < 0.00001` ï¼Œå…·ä½“å°äºå¤šå°‘ï¼Œå–å†³äºä½ å¯¹ç²¾åº¦çš„éœ€æ±‚ã€‚

```rust
fn main() {
    let abc: (f32, f32, f32) = (0.1, 0.2, 0.3);
    let xyz: (f64, f64, f64) = (0.1, 0.2, 0.3);

    println!("abc (f32)");
    println!("   0.1 + 0.2: {:x}", (abc.0 + abc.1).to_bits());
    println!("         0.3: {:x}", (abc.2).to_bits());
    println!();

    println!("xyz (f64)");
    println!("   0.1 + 0.2: {:x}", (xyz.0 + xyz.1).to_bits());
    println!("         0.3: {:x}", (xyz.2).to_bits());
    println!();

    assert!(abc.0 + abc.1 == abc.2);
    assert!(xyz.0 + xyz.1 == xyz.2);
}
```

è¿è¡Œè¯¥ç¨‹åºï¼Œè¾“å‡ºå¦‚ä¸‹:

```console
abc (f32)
   0.1 + 0.2: 3e99999a
         0.3: 3e99999a

xyz (f64)
   0.1 + 0.2: 3fd3333333333334
         0.3: 3fd3333333333333

thread 'main' panicked at 'assertion failed: xyz.0 + xyz.1 == xyz.2',
â¥ch2-add-floats.rs.rs:14:5
note: run with `RUST_BACKTRACE=1` environment variable to display
â¥a backtrace
```

### å­—ç¬¦(char)

å­—ç¬¦å­—é¢é‡æ˜¯ç”¨å•å¼•å·æ‹¬èµ·æ¥çš„å­—ç¬¦ï¼Œæ¯”å¦‚ `'8'` è· `'!'`ã€‚ è¿˜å¯ä»¥ç”¨å…¨è§’ `Unicode` å­—ç¬¦ï¼Œæ¯”å¦‚ `'ä¸­'` æˆ– `'å›½'`ã€‚

ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å‡ ä¸ªé¢‡å…·å¼‚åŸŸé£æƒ…çš„å­—ç¬¦ï¼š

```rust
fn main() {
    let c = 'z';
    let z = 'â„¤';
    let g = 'å›½';
    let heart_eyed_cat = 'ğŸ˜»';
}
```

åœ¨ Rust è¯­è¨€ä¸­è¿™äº›éƒ½æ˜¯å­—ç¬¦ï¼ŒRust çš„å­—ç¬¦ä¸ä»…ä»…æ˜¯ `ASCII`ï¼Œæ‰€æœ‰çš„ `Unicode` å€¼éƒ½å¯ä»¥ä½œä¸º Rust å­—ç¬¦ï¼ŒåŒ…æ‹¬å•ä¸ªçš„ä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ã€emoji è¡¨æƒ…ç¬¦å·ç­‰ç­‰ï¼Œ
éƒ½æ˜¯åˆæ³•çš„å­—ç¬¦ç±»å‹ã€‚

ç”±äº `Unicode` éƒ½æ˜¯ 4 ä¸ªå­—èŠ‚ç¼–ç ï¼Œå› æ­¤å­—ç¬¦ç±»å‹ä¹Ÿæ˜¯å ç”¨ 4 ä¸ªå­—èŠ‚ï¼š

```rust
fn main() {
    let x = 'ä¸­';
    println!("å­—ç¬¦'ä¸­'å ç”¨äº†{}å­—èŠ‚çš„å†…å­˜å¤§å°",std::mem::size_of_val(&x));
    let x = 'a';
    println!("å­—ç¬¦'a'å ç”¨äº†{}å­—èŠ‚çš„å†…å­˜å¤§å°",std::mem::size_of_val(&x));
}
```

è¾“å‡ºå¦‚ä¸‹:

```
å­—ç¬¦'ä¸­'å ç”¨äº†4å­—èŠ‚çš„å†…å­˜å¤§å°
å­—ç¬¦'a'å ç”¨äº†4å­—èŠ‚çš„å†…å­˜å¤§å°
```

æ³¨ï¼šRust çš„å­—ç¬¦åªèƒ½ç”¨ '' æ¥è¡¨ç¤ºï¼Œ "" æ˜¯ç•™ç»™å­—ç¬¦ä¸²çš„ã€‚

Rust ä¸ä¼šåœ¨ `char` å’Œä»»ä½•å…¶ä»–ç±»å‹ä¹‹é—´è¿›è¡Œéšå¼è½¬æ¢ï¼Œå¯ä»¥ä½¿ç”¨ `as` è½¬æ¢è¿ç®—ç¬¦å°† `char` è½¬æ¢ä¸ºæ•´å‹ï¼Œ
å¯¹äºå°äº 32 ä½çš„ç±»å‹ï¼Œè¯¥å­—ç¬¦å€¼çš„é«˜ä½ä¼šè¢«æˆªæ–­ï¼š

```
assert_eq!('*' as i32, 42);
assert_eq!(97 as char, 'a');
assert_eq!('ä¸­' as u8, 45);
```

è¡¥å……ï¼š

```
Unicode æ˜¯ä¸€ç§å…¨çƒé€šç”¨çš„å­—ç¬¦ç¼–ç æ ‡å‡†ï¼Œæ—¨åœ¨ä¸ºæ¯ç§è¯­è¨€ä¸­çš„æ‰€æœ‰å­—ç¬¦åˆ†é…å”¯ä¸€çš„ç¼–ç ï¼Œä»è€Œè§£å†³ä¸åŒç¼–ç ç³»ç»Ÿä¹‹é—´çš„ä¸å…¼å®¹é—®é¢˜ã€‚
å®ƒä¸ºæ¯ä¸ªå­—ç¬¦æä¾›ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼ˆç§°ä¸ºç ç‚¹ï¼‰ï¼Œä½¿å¾—æ–‡æœ¬å¯ä»¥åœ¨å„ç§å¹³å°ã€è¯­è¨€å’Œç³»ç»Ÿä¹‹é—´æ— ç¼äº¤æ¢å’Œå¤„ç†ã€‚

å…¨è§’ Unicode?

å…¨è§’ï¼ˆFull-widthï¼‰æ˜¯æŒ‡åœ¨å­—ç¬¦ç¼–ç ä¸­ï¼Œä¸€ä¸ªå­—ç¬¦å ç”¨ä¸¤ä¸ªæ ‡å‡†å­—ç¬¦çš„å®½åº¦ï¼ˆé€šå¸¸æŒ‡ ASCII å­—ç¬¦çš„å®½åº¦ï¼‰ã€‚
åœ¨ Unicode æ ‡å‡†ä¸­ï¼Œé€šå¸¸ä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ï¼ˆCJKï¼‰å­—ç¬¦ã€ä¸€äº›æ ‡ç‚¹ç¬¦å·ç­‰éƒ½æ˜¯å…¨è§’å­—ç¬¦ï¼Œè€Œ ASCII å­—ç¬¦æ˜¯åŠè§’ï¼ˆHalf-widthï¼‰çš„ã€‚

Unicode ç ç‚¹?

Unicode ç ç‚¹ï¼ˆUnicode code pointï¼‰æ˜¯æŒ‡ Unicode å­—ç¬¦é›†ä¸­æ¯ä¸ªå­—ç¬¦å¯¹åº”çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚
å®ƒè¡¨ç¤ºä¸º U+ åè·Ÿä¸€ä¸ªåå…­è¿›åˆ¶çš„æ•°å­—ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ "A" çš„ Unicode ç ç‚¹æ˜¯ U+0041ã€‚
```

### å¸ƒå°”(bool)

Rust ä¸­çš„å¸ƒå°”ç±»å‹æœ‰ä¸¤ä¸ªå¯èƒ½çš„å€¼ï¼štrue å’Œ falseï¼Œå¸ƒå°”å€¼å ç”¨å†…å­˜çš„å¤§å°ä¸º 1 ä¸ªå­—èŠ‚ï¼š

```rust
fn main() {
    let t = true;

    let f: bool = false; // ä½¿ç”¨ç±»å‹æ ‡æ³¨,æ˜¾å¼æŒ‡å®šfçš„ç±»å‹

    if f {
        println!("è¿™æ˜¯æ®µæ¯«æ— æ„ä¹‰çš„ä»£ç ");
    }
}
```

ä½¿ç”¨å¸ƒå°”ç±»å‹çš„åœºæ™¯ä¸»è¦åœ¨äºæµç¨‹æ§åˆ¶ï¼Œä¾‹å¦‚ä¸Šè¿°ä»£ç çš„ä¸­çš„ if å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚


### å•å…ƒç±»å‹

å•å…ƒç±»å‹å°±æ˜¯ () ï¼Œå¯¹ï¼Œä½ æ²¡çœ‹é”™ï¼Œå°±æ˜¯ () ï¼Œå”¯ä¸€çš„å€¼ä¹Ÿæ˜¯ () ï¼Œä¸€äº›è¯»è€…è¯»åˆ°è¿™é‡Œå¯èƒ½å°±ä¸æ„¿æ„äº†ï¼Œä½ ä¹Ÿå¤ªæ•·è¡äº†å§ï¼Œç®¡è¿™å«ç±»å‹ï¼Ÿ

åªèƒ½è¯´ï¼Œå†ä¸èµ·çœ¼çš„ä¸œè¥¿ï¼Œéƒ½æœ‰å…¶ç”¨é€”ï¼Œåœ¨ç›®å‰ä¸ºæ­¢çš„å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œå¤§å®¶å·²ç»çœ‹åˆ°è¿‡å¾ˆå¤šæ¬¡ fn main() å‡½æ•°çš„ä½¿ç”¨å§ï¼Ÿé‚£ä¹ˆè¿™ä¸ªå‡½æ•°è¿”å›ä»€ä¹ˆå‘¢ï¼Ÿ

æ²¡é”™ï¼Œ main å‡½æ•°å°±è¿”å›è¿™ä¸ªå•å…ƒç±»å‹ ()ï¼Œä½ ä¸èƒ½è¯´ main å‡½æ•°æ— è¿”å›å€¼ï¼Œå› ä¸ºæ²¡æœ‰è¿”å›å€¼çš„å‡½æ•°åœ¨ Rust ä¸­æ˜¯æœ‰å•ç‹¬çš„å®šä¹‰çš„ï¼šå‘æ•£å‡½æ•°( diverge function )ï¼Œé¡¾åæ€ä¹‰ï¼Œæ— æ³•æ”¶æ•›çš„å‡½æ•°ã€‚

ä¾‹å¦‚å¸¸è§çš„ println!() çš„è¿”å›å€¼ä¹Ÿæ˜¯å•å…ƒç±»å‹ ()ã€‚

å†æ¯”å¦‚ï¼Œä½ å¯ä»¥ç”¨ () ä½œä¸º map çš„å€¼ï¼Œè¡¨ç¤ºæˆ‘ä»¬ä¸å…³æ³¨å…·ä½“çš„å€¼ï¼Œåªå…³æ³¨ keyã€‚ è¿™ç§ç”¨æ³•å’Œ Go è¯­è¨€çš„ struct{} ç±»ä¼¼ï¼Œå¯ä»¥ä½œä¸ºä¸€ä¸ªå€¼ç”¨æ¥å ä½ï¼Œä½†æ˜¯å®Œå…¨ä¸å ç”¨ä»»ä½•å†…å­˜ã€‚


### å…ƒç»„tuple

å…ƒç»„æ˜¯ç”±å¤šç§ç±»å‹ç»„åˆåˆ°ä¸€èµ·å½¢æˆçš„ï¼Œå› æ­¤å®ƒæ˜¯å¤åˆç±»å‹ï¼Œå…ƒç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œå…ƒç»„ä¸­å…ƒç´ çš„é¡ºåºä¹Ÿæ˜¯å›ºå®šçš„.

```rust
fn main() {
    let tup: (i32, f64, u8) = (500, 6.4, 1);

    println!("The value of tup is: {:?}", tup);
}
```

ä½¿ç”¨æ¨¡å¼åŒ¹é…è§£æ„å…ƒç»„

```rust
fn main() {
    let tup = (500, 6.4, 1);

    let (_x, y, _z) = tup;

    println!("The value of y is: {}", y);
}
```

è®¿é—®æŸä¸ªç‰¹å®šå…ƒç´ ï¼Œç´¢å¼•ä» 0 å¼€å§‹

```rust
fn main() {
    let x: (i32, f64, u8) = (500, 6.4, 1);

    let five_hundred = x.0;

    let six_point_four = x.1;

    let one = x.2;
}
```

å…ƒç»„çš„æˆå‘˜è¿˜å¯ä»¥æ˜¯ä¸€ä¸ªå…ƒç»„

```rust
fn main() {
    let _t1: (u8, (i16, u32)) = (0, (-1, 1));
}
```

ä¸‹é¢ä¸¤ç§è®¿é—®æ–¹å¼æ˜¯é”™è¯¯çš„

```
// é”™è¯¯ï¼Œä¸èƒ½ä½¿ç”¨å˜é‡æ¥è®¿é—®å…ƒç»„çš„å…ƒç´ 
fn main() {
    let a = (1, 2, 3); 

    for i in range(0, 3) {
        println!("{}", a.i);
    }

}

// é”™è¯¯ï¼Œå…ƒç¥–ä¸æ”¯æŒè¿­ä»£
fn main() {
    let a = (1, 2, 3); 

    for i in &a {
        println!("{}", i);
    }

}
```

æ­£ç¡®æ–¹å¼ï¼Œå…ƒç»„è½¬æ¢ä¸ºæ•°ç»„è¿›è¡Œè¿­ä»£ï¼ˆå…ƒç´ æ•°æ®ç±»å‹ä¸€è‡´ï¼‰

```rust
fn main() {
    let a = (1, 2, 3); 
    let array = [a.0, a.1, a.2]; 

    for i in &array {
        println!("{}", i);
    }
}
```

åŒ…å«å•ä¸ªå€¼çš„å…ƒç»„ï¼Œç§°ä¸ºå•å…ƒç´ å…ƒç»„ï¼Œå®ƒçš„ç±»å‹æ˜¯ (T,)ï¼Œå…¶ä¸­ T æ˜¯å•ä¸ªå…ƒç´ çš„ç±»å‹ï¼Œé€—å·æ˜¯å¿…é¡»çš„ï¼Œä»¥åŒºåˆ†å®ƒå’Œè¢«æ‹¬å·åŒ…è£¹çš„å€¼ã€‚

```rust
fn main() {
    let x = (1,); // å•å…ƒç´ å…ƒç»„
    let y = (2); // ä¸€ä¸ªæ•´æ•°
}
```

### æŒ‡é’ˆ

#### å¼•ç”¨

`&i32` æ˜¯å¯¹ `i32` ç±»å‹çš„å¼•ç”¨ï¼Œå¼•ç”¨æ˜¯ä¸€ä¸ªä¿å­˜ç€ i32 åœ°å€çš„æœºå™¨å­—ï¼Œè¿™ä¸ªåœ°å€å¯èƒ½ä½äºæ ˆæˆ–å †ä¸­ã€‚

å¼•ç”¨æœ‰ä¸¤ç§å½¢å¼ï¼š

* ä¸å¯å˜å¼•ç”¨ï¼ˆimmutable referencesï¼‰ï¼š`&T`ã€‚ä¸€ä¸ªä¸å¯å˜çš„å…±äº«å¼•ç”¨ï¼Œå¯ä»¥åŒæ—¶æ‹¥æœ‰å¤šä¸ªå¯¹å®šå€¼çš„å…±äº«å¼•ç”¨ã€‚

* å¯å˜å¼•ç”¨ï¼ˆmutable referencesï¼‰ï¼š`&mut T`ã€‚ä¸€ä¸ªå¯å˜çš„ï¼Œç‹¬å çš„å¼•ç”¨ï¼Œåªè¦æ”¹å¼•ç”¨è¿˜å­˜åœ¨ï¼Œå°±ä¸èƒ½å¯¹æ”¹å€¼æœ‰ä»»ä½•ç±»å‹çš„å…¶ä»–å¼•ç”¨ã€‚


#### Box

`Box<T>` æ˜¯ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘åˆ†é…åœ¨å †ä¸Šçš„å€¼ã€‚


#### è£¸æŒ‡é’ˆ

Rust ä¹Ÿæœ‰è£¸æŒ‡é’ˆç±»å‹ `*const T` å’Œ `*mut T`ï¼Œåˆ†åˆ«æ˜¯ä¸å¯å˜å’Œå¯å˜çš„è£¸æŒ‡é’ˆã€‚è£¸æŒ‡é’ˆæ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒä»¬ä¸å— Rust å€Ÿç”¨æ£€æŸ¥å™¨çš„çº¦æŸã€‚è£¸æŒ‡é’ˆå¯èƒ½ä¸ºç©ºï¼Œæˆ–è€…ä»–ä»¬å¯èƒ½æŒ‡å‘å·²é‡Šæ”¾çš„å†…å­˜æˆ–åŒ…å«ä¸åŒç±»å‹çš„å€¼ã€‚

åªèƒ½åœ¨ `unsafe` å—ä¸­å¯¹è£¸æŒ‡é’ˆè§£å¼•ç”¨ï¼ˆdereferenceï¼‰ã€‚


### æ•°ç»„

æ•°ç»„ `array` æ˜¯å­˜å‚¨åœ¨æ ˆä¸Šï¼Œå…ƒç´ ç±»å‹å¤§å°å›ºå®šï¼Œä¸”é•¿åº¦ä¹Ÿæ˜¯å›ºå®šã€‚

æ•°ç»„å£°æ˜æ–¹å¼:

```
// æ–¹å¼ 1
fn main() {
    let a = [1, 2, 3, 4, 5];
}

// æ–¹å¼ 2
fn main() {
    let a: [i32; 5] = [1, 2, 3, 4, 5];
}
```

å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¯­æ³•åˆå§‹åŒ–ä¸€ä¸ªæŸä¸ªå€¼é‡å¤å‡ºç° N æ¬¡çš„æ•°ç»„ï¼š

```
let a = [3; 5];
// ç­‰ä»·äº
let a = [3, 3, 3, 3, 3];
```

**è®¿é—®æ•°ç»„å…ƒç´ **

å› ä¸ºæ•°ç»„æ˜¯è¿ç»­å­˜æ”¾å…ƒç´ çš„ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ç´¢å¼•çš„æ–¹å¼æ¥è®¿é—®å­˜æ”¾å…¶ä¸­çš„å…ƒç´ 

```rust
fn main() {
    let a = [9, 8, 7, 6, 5];

    let first = a[0];  // è·å–ç¬¬ä¸€ä¸ªå…ƒç´ 
    let second = a[1]; // è·å–ç¬¬äºŒä¸ªå…ƒç´ 
}
```
å¾ªç¯è¿­ä»£æ•°ç»„å…ƒç´ 

```rust
fn main() {
    let a = [9, 8, 7, 6, 5];
    for i in &a {
        println!("{}", i);
    }
}
```

**ä¿®æ”¹æ•°ç»„å…ƒç´ **

```rust
fn main() {
    let mut a = [3; 5];

    println!("{:?}", a);
    a[2] = 5;
}
```

**æ•°ç»„åˆ‡ç‰‡**

```rust
fn main() {
    let mut a = [3; 5];

    println!("{:?}", a);
    a[2] = 5;

    let b = &mut a[1..3];
    println!("{:?}", b);

    b[1] = 10; 
    println!("{:?}", b);
    println!("{:?}", a);
}
```

æ³¨ï¼šåœ¨æ•°ç»„ä¸Šçœ‹åˆ°çš„é‚£äº›å®ç”¨æ–¹æ³•ï¼ˆéå†å…ƒç´ ã€æœç´¢ã€æ’åºã€å¡«å……ã€è¿‡æ»¤ç­‰ï¼‰éƒ½æ˜¯ä½œä¸ºåˆ‡ç‰‡è€Œéæ•°ç»„çš„æ–¹å¼æä¾›çš„ã€‚ä½†æ˜¯ Rust åœ¨æœç´¢å„ç§æ–¹æ³•æ—¶ä¼šéšå¼åœ°å°†å¯¹æ•°ç»„çš„å¼•ç”¨è½¬æ¢ä¸ºåˆ‡ç‰‡ï¼Œå› æ­¤å¯ä»¥ç›´æ¥åœ¨æ•°ç»„ä¸Šè°ƒç”¨ä»»ä½•åˆ‡ç‰‡æ–¹æ³•ã€‚


### Vector

ä¸€ä¸ª `Vec<T>` æ˜¯ä¸€ä¸ªé•¿åº¦å¯å˜çš„ç±»å‹ T çš„æ•°ç»„ï¼Œå®ƒçš„å…ƒç´ éƒ½å­˜å‚¨åœ¨å †ä¸Šã€‚

ä¸€ä¸ª `Vec<T>` ç”± 3 ä¸ªå€¼ç»„æˆï¼šä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å †ä¸Šå­˜å‚¨å…ƒç´ çš„ç¼“å†²åŒºï¼Œè¿™ä¸ªç¼“å†²åŒºçš„æ‰€æœ‰æƒå±äºè¿™ä¸ª `Vec<T>`ï¼›ç¼“å†²åŒºå¯ä»¥å­˜å‚¨çš„å…ƒç´ çš„æ•°é‡ï¼›å®ƒç°åœ¨å®é™…å·²ç»æ‹¥æœ‰çš„å…ƒç´ çš„æ•°é‡ï¼ˆä¹Ÿå°±æ˜¯å®ƒçš„é•¿åº¦ï¼‰ã€‚å½“ç¼“å†²åŒºçš„çš„å…ƒç´ åˆ°è¾¾æœ€å¤§å®¹é‡æ—¶ï¼Œç»§ç»­æ·»åŠ å…ƒç´ ä¼šå¯¼è‡´vectoré‡æ–°åˆ†é…ä¸€ä¸ªæ›´å¤§çš„ç¼“å†²åŒºï¼Œå†æŠŠå·²æœ‰å…ƒç´ éƒ½æ‹·è´è¿‡å»ï¼Œç„¶åæ›´æ–° vectorçš„æŒ‡é’ˆå’Œå®¹é‡ï¼Œæœ€åé‡Šæ”¾æ—§çš„ç¼“å†²åŒºã€‚

**åˆ›å»º**

ä½¿ç”¨ `vec!` å®åˆ›å»ºä¸€ä¸ª `Vec<T>`:

```rust
fn main() {
    let mut v = vec![1, 2, 3, 4, 5];
    println!("v = {:?}", v);  // v = [1, 2, 3, 4, 5]
    v.push(11);
    v.push(13);
    println!("v = {:?}", v);  // v = [1, 2, 3, 4, 5, 11, 13]
}
```

`vec!` å®ç­‰ä»·äºè°ƒç”¨ `Vec::new` åˆ›å»ºä¸€ä¸ªæ–°çš„ç©º vector:

```rust
fn main() {
    let mut v = Vec::new();
    v.push(1);
    v.push(2);
    v.push(3);
    println!("v = {:?}", v);  // v = [1, 2, 3]
}
```

å¦ä¸€ç§åˆ›å»º vector çš„æ–¹æ³•æ˜¯é€šè¿‡è¿­ä»£å™¨åˆ›å»ºï¼š

```rust
fn main() {
    let v: Vec<i32> = (0..5).collect();
    println!("v = {:?}", v);  // v = [0, 1, 2, 3, 4]
}
```

å¯ä»¥ä½¿ç”¨ `Vec::with_capacity` æ¥åˆ›å»ºä¸€ä¸ªæŒ‡å®šçš„ç¼“å†²åŒºçš„ vectorï¼Œé¿å…é‡æ–°åˆ†é…å†…å­˜ã€‚

```rust
fn main() {
    let mut v = Vec::with_capacity(2);
    println!("{:?}", v.len());      // 0
    println!("{:?}", v.capacity()); // 2
    v.push(1);
    v.push(2);
    println!("{:?}", v.len());      // 2
    println!("{:?}", v.capacity()); // 2
}
```

**æ’å…¥ã€ç§»é™¤**

å¯ä»¥åœ¨ vector ä¸­ä»»æ„æ’å…¥æˆ–ç§»é™¤å…ƒç´ ï¼Œè¿™äº›æ“ä½œä¼šç§»åŠ¨ä¿®æ”¹ä½ç½®å‰é¢æˆ–è€…åé¢çš„å…ƒ
ç´ ã€‚

```rust
fn main() {
    let mut v = vec![10, 20, 30, 40, 50];
    // åœ¨ç´¢å¼•ä¸º 3çš„åœ°æ–¹æ’å…¥ 35
    v.insert(3, 35);
    assert_eq!(v, [10, 20, 30, 35, 40, 50]);
    // ç§»é™¤ç´¢å¼•ä¸º 1çš„å…ƒç´ 
    v.remove(1);
    assert_eq!(v, [10, 30, 35, 40, 50]);
}
```

ä½ å¯ä»¥ä½¿ç”¨ pop æ–¹æ³•ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ å¹¶è¿”å›å®ƒã€‚æ›´ç¡®åˆ‡åœ°è¯´ï¼Œä» `Vec<T>` ä¸­å¼¹å‡ºåªä¼šè¿”å›ä¸€ä¸ª `Option<T>`ï¼šå¦‚æœ vector å·²ç»ä¸ºç©ºæ˜¯ Noneï¼Œå¦‚æœæœ€åä¸€ä¸ªå…ƒç´ æ˜¯ v å°±æ˜¯ Some(v)ï¼š

```rust
fn main() {
    let mut v = vec!["Snow Puff", "Glass Gem"];
    assert_eq!(v.pop(), Some("Glass Gem"));
    assert_eq!(v.pop(), Some("Snow Puff"));
    assert_eq!(v.pop(), None);
}
```

**å¾ªç¯è®¿é—®**

```rust
fn main() {
    let a = vec![1, 2, 3, 4, 5];

    // å€Ÿç”¨
    for i in &a {
        println!("{}", i);
    }

    for i in a {
        println!("{}", i);
    }

    // æŠ¥é”™ï¼Œaå·²ç»è¢«moveäº†
    println!("{:?}", a);
}
```

### åˆ‡ç‰‡

åˆ‡ç‰‡çš„å¼•ç”¨æ˜¯èƒ–æŒ‡é’ˆï¼šä¸€ä¸ªåŒ…å«æŒ‡å‘åˆ‡ç‰‡ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆå’Œåˆ‡ç‰‡ä¸­å…ƒç´ æ•°é‡çš„åŒå­—
å€¼ã€‚

å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸‹åˆ—ä»£ç ï¼š

```rust
let v: Vec<f64> = vec![0.0, 0.707, 1.0, 0.707];
let a: [f64; 4] = [0.0, -0.707, -1.0, -0.707];

let sv: &[f64] = &v;
let sa: &[f64] = &a;
```

ä¸Šé¢ä»£ç è¿è¡Œå®Œåï¼Œå†…å­˜å¸ƒå±€å¦‚ä¸‹ï¼š

![slice](/images/slice.png)

ä¸€ä¸ªæ™®é€šçš„å¼•ç”¨æ˜¯ä¸€ä¸ªæŒ‡å‘å•ä¸ªå€¼çš„æ— æ‰€æœ‰æƒæŒ‡é’ˆï¼Œè€Œä¸€ä¸ªåˆ‡ç‰‡çš„å¼•ç”¨æ˜¯ä¸€ä¸ªæŒ‡å‘å†…å­˜ä¸­
è¿ç»­çš„èŒƒå›´çš„æŒ‡é’ˆã€‚è¿™ä½¿å¾—å¦‚æœä½ æƒ³å†™ä¸€ä¸ªå¤„ç†æ•°ç»„æˆ– vectorçš„å‡½æ•°ï¼Œé‚£ä¹ˆåˆ‡ç‰‡å¼•ç”¨å°†æ˜¯ä¸€
ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå‡½æ•°æ‰“å°å‡ºä¸€ç³»åˆ—å€¼ï¼Œæ¯ä¸ªå•ç‹¬ä¸€è¡Œï¼š
    
```rust
fn print(n: &[f64]) {
    for elt in n {
        println!("{}", elt);
    } 
}

print(&a); // å¯ä»¥ç”¨äºæ•°ç»„
print(&v); // ä¹Ÿå¯ä»¥ç”¨äº vector
```

### å­—ç¬¦ä¸²

Rust çš„å­—ç¬¦ä¸²ç±»å‹æ˜¯ `&str` å’Œ `String`ã€‚

#### å­—ç¬¦ä¸²å­—é¢é‡

å­—ç¬¦ä¸²å­—é¢é‡ &str è¢«åŒå¼•å·åŒ…è£¹ï¼Œå’Œ char å­—é¢é‡ä¸€æ ·æ˜¯é€šè¿‡åæ–œæ æ¥è½¬ä¹‰ï¼š

```rust
fn main() {
    let speech = "\"Ouch!\" said the well.";
    println!("{}", speech);   // "Ouch!" said the well.
}
```

å¦‚æœå­—ç¬¦ä¸²ä¸­çš„ä¸€è¡Œä»¥åæ–œæ ç»“å°¾ï¼Œé‚£ä¹ˆæ¢è¡Œç¬¦å’Œä¸‹ä¸€è¡Œçš„å‰å¯¼ç©ºæ ¼å°±ä¼šè¢«ä¸¢å¼ƒæ‰ï¼š

```rust
fn main() {
    let speech = "much ado about \
    nothing";
    println!("{}", speech);   // much ado about nothing
}
```

ç”¨å°å†™å­—æ¯ `r` æ¥æä¾›äº†åŸå§‹å­—ç¬¦ä¸²ï¼ŒåŸå§‹å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰åæ–œæ å’Œç©ºç™½å­—ç¬¦éƒ½è¢«åŸæ ·åŒ…å«åœ¨å­—ç¬¦ä¸²é‡Œï¼Œ
ä¸ä¼šè¯†åˆ«ä»»ä½•è½¬ä¹‰ï¼š

```rust
fn main() {
    let default_win_install_path = r"C:\Program Files\Gorillas";
    println!("{}", default_win_install_path);  
    // C:\Program Files\Gorillas

    println!(r###"
    This raw string started with 'r###"'.
    Therefore it does not end until we reach a quote mark ('"')
    followed immediately by three pound signs ('###'):
    "###);

    // This raw string started with 'r###"'.
    // Therefore it does not end until we reach a quote mark ('"')
    // followed immediately by three pound signs ('###'):
}
```

#### å­—èŠ‚ä¸²

ä»¥ b å‰ç¼€å¼€å¤´çš„å­—ç¬¦ä¸²å­—é¢é‡æ˜¯å­—èŠ‚å­—ç¬¦ä¸²ã€‚è¿™ç§å­—ç¬¦ä¸²å®é™…ä¸Šæ˜¯u8 å€¼çš„åˆ‡ç‰‡â€”â€”ä¹Ÿå°±æ˜¯
å­—èŠ‚æµâ€”â€”è€Œä¸æ˜¯ Unicode æ–‡æœ¬ï¼š

```rust
let method = b"GET";
assert_eq!(method, &[b'G', b'E', b'T']);
```

#### å†…å­˜ä¸­çš„å­—ç¬¦ä¸²

Rustçš„å­—ç¬¦ä¸²æ˜¯ Unicode å­—ç¬¦çš„åºåˆ—ï¼Œä½†å®ƒå¹¶ä¸æ˜¯ä½œä¸ºchar çš„æ•°ç»„å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚äº‹å®ä¸Š
å®ƒä½¿ç”¨ UTF-8 ç¼–ç å­˜å‚¨ï¼Œè¿™æ˜¯ä¸€ç§å¯å˜é•¿åº¦çš„ç¼–ç ã€‚æ¯ä¸€ä¸ª ASCII å­—ç¬¦è¢«å­˜å‚¨ä¸ºä¸€ä¸ªå­—èŠ‚ï¼Œ
å…¶ä»–å­—ç¬¦å¯èƒ½ä¼šå æ®å¤šä¸ªå­—èŠ‚ã€‚

ä¸‹å›¾æ˜¾ç¤ºä¸‹é¢ä»£ç åˆ›å»ºçš„ String å’Œ &str:

```
let noodles = "noodles".to_string();
let oodles = &noodles[1..];
let poodles = "à²¨à²®à²¸à³à²•à²¾à²°"
```

![alt text](/images/string.png)

noodles æ˜¯ä¸€ä¸ªæ‹¥æœ‰ 8 ä¸ªå­—èŠ‚å¤§å°çš„ç¼“å†²åŒºçš„ Stringï¼Œå…¶ä¸­ 7 ä¸ªå­—èŠ‚å·²ç»è¢«ä½¿ç”¨ã€‚ä½ å¯ä»¥å°†String æƒ³è±¡ä¸ºä¿è¯å†…å®¹æ˜¯æœ‰æ•ˆ UTF-8 ç¼–ç çš„ Vec<u8>ï¼›äº‹å®ä¸Šï¼ŒString å°±æ˜¯è¿™ä¹ˆå®ç°çš„ã€‚

ä¸€ä¸ª &strï¼ˆè¯»ä½œâ€œstirâ€æˆ–è€…â€œå­—ç¬¦ä¸²åˆ‡ç‰‡â€ï¼‰æ˜¯ä¸€ä¸ªæŒ‡å‘å…¶ä»–å€¼æ‹¥æœ‰çš„UTF-8 æ–‡æœ¬çš„å¼•ç”¨ï¼š
å®ƒâ€œå€Ÿç”¨â€äº†è¿™æ®µæ–‡æœ¬ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œoodles æ˜¯ä¸€ä¸ªæŒ‡å‘ noodles æ‰€æŒæœ‰çš„æ–‡æœ¬ä¸­çš„æœ€åå…­
ä¸ªå­—èŠ‚çš„ &strï¼Œå› æ­¤å®ƒè¡¨ç¤ºæ–‡æœ¬â€œoodlesâ€ã€‚å°±åƒå…¶ä»–åˆ‡ç‰‡å¼•ç”¨ä¸€æ ·ï¼Œ&str æ˜¯ä¸€ç§èƒ–æŒ‡é’ˆï¼ŒåŒ…
æ‹¬å®é™…æ•°æ®çš„åœ°å€å’Œé•¿åº¦ã€‚ä½ å¯ä»¥å°† &str çœ‹ä½œä¸€ä¸ªä¿è¯å†…å®¹ä¸ºåˆæ³•çš„ UTF-8 ç¼–ç çš„ &[u8]ã€‚

å­—ç¬¦ä¸²å­—é¢é‡æ˜¯ä¸€ä¸ªæŒ‡å‘é¢„å…ˆåˆ†é…å¥½å†…å­˜çš„æ–‡æœ¬çš„ &strï¼Œå®é™…çš„æ–‡æœ¬é€šå¸¸å’Œç¨‹åºçš„æœºå™¨ç 
ä¸€èµ·å­˜å‚¨åˆ°åªè¯»çš„å†…å­˜åŒºåŸŸã€‚åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œpoodles æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ï¼ŒæŒ‡å‘ç¨‹åºè¿
è¡Œæ—¶å°±å·²ç»è¢«åˆ›å»ºå¥½å¹¶ä¸”æŒç»­åˆ°ç¨‹åºé€€å‡ºçš„ 7 ä¸ªå­—èŠ‚ã€‚

ä¸€ä¸ª String æˆ– &str çš„ `len()` æ–¹æ³•è¿”å›å®ƒçš„é•¿åº¦ã€‚ä½†è¿™ä¸ªé•¿åº¦æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œè€Œä¸æ˜¯ä»¥
å­—ç¬¦ä¸ºå•ä½ï¼š

```
assert_eq!("à²¨à²®à²¸à³à²•à²¾à²°".len(), 21);
```

è¦åœ¨è¿è¡Œæ—¶åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²ï¼Œè¦ä½¿ç”¨ Stringã€‚

#### String

&str å’Œ &[T] å¾ˆåƒï¼šéƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘æŸäº›æ•°æ®çš„èƒ–æŒ‡é’ˆã€‚String ç±»ä¼¼äº Vec<T>ï¼Œå¦‚è¡¨ 3-11æ‰€ç¤ºã€‚

<img src="/images/string-vec.png" alt="string-vec" width="650">

ç±»ä¼¼äº Vecï¼Œæ¯ä¸ª String éƒ½æœ‰å®ƒè‡ªå·±çš„åœ¨å †ä¸Šåˆ†é…çš„ç¼“å†²åŒºï¼Œè¿™ä¸ªç¼“å†²åŒºä¸å’Œå…¶ä»–ä»»
ä½• String å…±äº«ã€‚

æœ‰å‡ ç§æ–¹å¼åˆ›å»º Stringï¼š

`.to_string()` æ–¹æ³•æŠŠ &str è½¬æ¢ä¸ºä¸€ä¸ª Stringï¼Œè¿™ä¼šæ‹·è´å­—ç¬¦ä¸²ï¼š

```rust
let error_message = "too many pets".to_string()
```

`format!()` å®ç±»ä¼¼äº `println!()`ï¼ŒåŒºåˆ«åœ¨äºå®ƒè¿”å›ä¸€ä¸ªæ–°çš„ String è€Œä¸æ˜¯æŠŠå®ƒæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼Œè€Œä¸”å®ƒä¸ä¼šåœ¨æœ€åè‡ªåŠ¨åŠ ä¸Šæ¢è¡Œç¬¦ï¼š

```rust
assert_eq!(format!("{}Â°{:02}â€²{:02}â€³N", 24, 5, 23),
"24Â°05â€²23â€³N".to_string());
```

å­—ç¬¦ä¸²çš„æ•°ç»„ã€åˆ‡ç‰‡ã€vector éƒ½æœ‰ä¸¤ä¸ªæ–¹æ³• `.concat()` å’Œ `.join(sep)`ï¼ŒæŠŠå¤šä¸ªå­—ç¬¦ä¸²ç»„åˆæˆä¸€ä¸ªï¼š

```rust
let bits = vec!["veni", "vidi", "vici"];
assert_eq!(bits.concat(), "venividivici");
assert_eq!(bits.join(", "), "veni, vidi, vici");
```

## è¿ç®—

### æ•°å­—è¿ç®—

Rust æ”¯æŒæ‰€æœ‰æ•°å­—ç±»å‹çš„åŸºæœ¬æ•°å­¦è¿ç®—ï¼šåŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•ã€é™¤æ³•å’Œå–æ¨¡è¿ç®—ã€‚ä¸‹é¢ä»£ç å„ä½¿ç”¨ä¸€æ¡ `let` è¯­å¥æ¥è¯´æ˜ç›¸åº”è¿ç®—çš„ç”¨æ³•ï¼š

```rust
fn main() {
    // åŠ æ³•
    let sum = 5 + 10;

    // å‡æ³•
    let difference = 95.5 - 4.3;

    // ä¹˜æ³•
    let product = 4 * 30;

    // é™¤æ³•
    let quotient = 56.7 / 32.2;

    // æ±‚ä½™
    let remainder = 43 % 5;
}
```

[é™„å½• B](https://course.rs/appendix/operators.html#è¿ç®—ç¬¦) ä¸­ç»™å‡ºäº† Rust æä¾›çš„æ‰€æœ‰è¿ç®—ç¬¦çš„åˆ—è¡¨ã€‚

### ä½è¿ç®—

Rust çš„ä½è¿ç®—åŸºæœ¬ä¸Šå’Œå…¶ä»–è¯­è¨€ä¸€æ ·

| è¿ç®—ç¬¦  | è¯´æ˜                                                   |
| ------- | ------------------------------------------------------ |
| & ä½ä¸  | ç›¸åŒä½ç½®å‡ä¸º1æ—¶åˆ™ä¸º1ï¼Œå¦åˆ™ä¸º0                          |
| \| ä½æˆ– | ç›¸åŒä½ç½®åªè¦æœ‰1æ—¶åˆ™ä¸º1ï¼Œå¦åˆ™ä¸º0                        |
| ^ å¼‚æˆ–  | ç›¸åŒä½ç½®ä¸ç›¸åŒåˆ™ä¸º1ï¼Œç›¸åŒåˆ™ä¸º0                         |
| ! ä½é  | æŠŠä½ä¸­çš„0å’Œ1ç›¸äº’å–åï¼Œå³0ç½®ä¸º1ï¼Œ1ç½®ä¸º0                 |
| << å·¦ç§» | æ‰€æœ‰ä½å‘å·¦ç§»åŠ¨æŒ‡å®šä½æ•°ï¼Œå³ä½è¡¥0                        |
| >> å³ç§» | æ‰€æœ‰ä½å‘å³ç§»åŠ¨æŒ‡å®šä½æ•°ï¼Œå¸¦ç¬¦å·ç§»åŠ¨ï¼ˆæ­£æ•°è¡¥0ï¼Œè´Ÿæ•°è¡¥1ï¼‰ |

```rust
fn main() {
    // æ— ç¬¦å·8ä½æ•´æ•°ï¼ŒäºŒè¿›åˆ¶ä¸º00000010
    let a: u8 = 2; // ä¹Ÿå¯ä»¥å†™ let a: u8 = 0b_0000_0010;

    // äºŒè¿›åˆ¶ä¸º00000011
    let b: u8 = 3;

    // {:08b}ï¼šå·¦é«˜å³ä½è¾“å‡ºäºŒè¿›åˆ¶01ï¼Œä¸è¶³8ä½åˆ™é«˜ä½è¡¥0
    println!("a value is        {:08b}", a);

    println!("b value is        {:08b}", b);

    println!("(a & b) value is  {:08b}", a & b);

    println!("(a | b) value is  {:08b}", a | b);

    println!("(a ^ b) value is  {:08b}", a ^ b);

    println!("(!b) value is     {:08b}", !b);

    println!("(a << b) value is {:08b}", a << b);

    println!("(a >> b) value is {:08b}", a >> b);

    let mut a = a;
    // æ³¨æ„è¿™äº›è®¡ç®—ç¬¦é™¤äº†!ä¹‹å¤–éƒ½å¯ä»¥åŠ ä¸Š=è¿›è¡Œèµ‹å€¼ (å› ä¸º!=è¦ç”¨æ¥åˆ¤æ–­ä¸ç­‰äº)
    a <<= b;
    println!("(a << b) value is {:08b}", a);
}
```

## æ‰€æœ‰æƒå’Œç§»åŠ¨

è®¡ç®—æœºè¯­è¨€ä¸æ–­æ¼”å˜è¿‡ç¨‹ä¸­ï¼Œå†…å­˜ç®¡ç†å‡ºç°ä¸¤å¼ æ–¹å¼ï¼š

* åƒåœ¾å›æ”¶æœºåˆ¶(GC)ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ä¸æ–­å¯»æ‰¾ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œå…¸å‹ä»£è¡¨ï¼šJavaã€Go

* æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾, åœ¨ç¨‹åºä¸­ï¼Œé€šè¿‡å‡½æ•°è°ƒç”¨çš„æ–¹å¼æ¥ç”³è¯·å’Œé‡Šæ”¾å†…å­˜ï¼Œå…¸å‹ä»£è¡¨ï¼šC++ã€C

Rust é€‰æ‹©äº†ç¬¬ä¸‰ç§æ–¹å¼ï¼šæ‰€æœ‰æƒï¼Œå®ƒæ˜¯ä¸€ç§åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥å†…å­˜å®‰å…¨çš„ç³»ç»Ÿï¼Œä¸éœ€è¦åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä¹Ÿä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜ã€‚

æ³¨ï¼šæ‰€æœ‰æƒè§„åˆ™å¯ä»¥æ¦‚æ‹¬ä¸ºä¸‰ä¸ªæ ¸å¿ƒè§„åˆ™ï¼š

* Rust ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½ä¸ä¸€ä¸ªå˜é‡æ˜ç¡®å…³è”ï¼Œè¿™ä¸ªå˜é‡æ˜¯è¿™ä¸ªå€¼çš„æ‰€æœ‰è€…ï¼›

* ä»»ä¸€æ—¶åˆ»ï¼Œæ¯ä¸ªå€¼éƒ½åªä¸ä¸€ä¸ªå˜é‡æœ‰è¿™ç§å…³è”ï¼ˆç¦æ­¢å…±äº«ï¼‰ï¼›

* å½“è¿™ä¸ªå˜é‡ç¦»å¼€ä½œç”¨åŸŸï¼Œä¸ä¹‹å…³è”çš„å€¼å°±ä¼šè¢«å›æ”¶ï¼ˆé‡Šæ”¾èµ„æºæ˜¯å®‰å…¨çš„ï¼‰ã€‚

### æ‰€æœ‰æƒ

ä½†åœ¨ Rustä¸­ï¼Œæ‰€æœ‰æƒçš„æ¦‚å¿µè¢«å†…å»ºåœ¨è¯­è¨€ä¹‹ä¸­ï¼Œå¹¶ä¸”é€šè¿‡ç¼–è¯‘æœŸæ£€æŸ¥ç¡®ä¿å¼ºåˆ¶æ‰§è¡Œã€‚æ¯ä¸ª
å€¼éƒ½åªæœ‰ä¸€ä¸ªå†³å®šå®ƒç”Ÿå‘½å‘¨æœŸçš„æ‰€æœ‰è€…ã€‚å½“æ‰€æœ‰è€…è¢«é‡Šæ”¾ï¼Œå®ƒæ‹¥æœ‰çš„å€¼ä¹Ÿä¼šåŒæ—¶è¢«é‡Šæ”¾ï¼Œ
åœ¨ Rustä¸­çš„æœ¯è¯­ä¸­ï¼Œé‡Šæ”¾çš„è¡Œä¸ºè¢«ç§°ä¸ºä¸¢å¼ƒï¼ˆdropï¼‰ã€‚

```rust
fn print_padovan() {
    let mut padovan = vec![1,1,1]; // åœ¨è¿™é‡Œåˆ†é…
    for i in 3..10 {
        let next = padovan[i-3] + padovan[i-2];
    padovan.push(next);
    }
    println!("P(1..10) = {:?}", padovan);
} // padovan åœ¨è¿™é‡Œé‡Šæ”¾
```

Ruståœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ‰©å±•äº†æ‰€æœ‰æƒçš„çµæ´»æ€§ï¼š

* ä½ å¯ä»¥å°†å€¼ä»ä¸€ä¸ªæ‰€æœ‰è€…ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ‰€æœ‰è€…ã€‚è¿™å…è®¸ä½ æ„å»ºã€æ›´æ”¹ã€æ‹†é™¤æ‰€æœ‰æƒæ ‘ã€‚

* å¾ˆç®€å•çš„ç±»å‹ä¾‹å¦‚æ•´æ•°ã€æµ®ç‚¹æ•°å’Œå­—ç¬¦è¢«æ‰€æœ‰æƒè§„åˆ™æ’é™¤åœ¨å¤–ã€‚å®ƒä»¬è¢«ç§°ä¸º Copy ç±»å‹ã€‚

* æ ‡å‡†åº“æä¾›äº†å¼•ç”¨è®¡æ•°çš„æŒ‡é’ˆç±»å‹ Rc å’Œ Arcï¼Œå®ƒä»¬å…è®¸å€¼åœ¨ä¸€å®šçš„é™åˆ¶ä¸‹å¯ä»¥æœ‰å¤šä¸ªæ‰€
æœ‰è€…ã€‚

* ä½ å¯ä»¥â€œå€Ÿç”¨ä¸€ä¸ªå€¼çš„å¼•ç”¨â€ï¼Œå¼•ç”¨æ˜¯ç”Ÿå‘½å‘¨æœŸå—é™çš„éå æœ‰çš„æŒ‡é’ˆã€‚

### ç§»åŠ¨

åœ¨ Rusté‡Œå¯¹å¤§å¤šæ•°ç±»å‹æ¥è¯´ï¼Œèµ‹å€¼ç»™å˜é‡ã€æŠŠå€¼ä¼ ç»™å‡½æ•°ã€æˆ–è€…ä»å‡½æ•°è¿”å›å€¼å¹¶ä¸ä¼šæ‹·
è´è¿™ä¸ªå€¼ï¼šå®ƒä»¬åªä¼šç§»åŠ¨å®ƒã€‚æºå¯¹è±¡æ”¾å¼ƒäº†å€¼çš„æ‰€æœ‰æƒï¼ŒæŠŠæ‰€æœ‰æƒè½¬ç§»ç»™äº†ç›®çš„å¯¹è±¡ï¼ŒåŒ
æ—¶æºå¯¹è±¡å˜ä¸ºæœªåˆå§‹åŒ–çš„çŠ¶æ€ï¼›

```rust
let s = vec!["udon".to_string(), "ramen".to_string, "soba".to_string()];
let t = s;
let u = s; // ç¼–è¯‘é”™è¯¯
```

èµ‹å€¼è¯­å¥ `let t = s`; æŠŠ vector çš„ä¸‰ä¸ªå­—æ®µä» s ç§»åŠ¨åˆ°äº† tï¼›ç°åœ¨ t æ‹¥æœ‰äº†è¿™ä¸ª vector, s å˜æˆäº†æœªåˆå§‹åŒ–çš„çŠ¶æ€ã€‚å¦‚æœä½ å°è¯•ä½¿ç”¨ sï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚

<img src="/images/move.png" alt="move" width="650">

å¯ä»¥å¯¹å…ƒç´ è¿›è¡Œæ·±æ‹·è´ï¼Œè¿™æ ·å°±ä¸ä¼šç§»åŠ¨æ‰€æœ‰æƒï¼š

```rust
let s = vec!["udon".to_string(), "ramen".to_string(), "soba".to_string()];
let t = s.clone();
let u = s.clone();
```

#### ç§»åŠ¨æ›´å¤šæ“ä½œ

å¦‚æœä½ æŠŠå€¼ç§»åŠ¨è¿›ä¸€ä¸ªå·²ç»è¢«åˆå§‹åŒ–çš„å˜é‡ï¼ŒRustä¼š drop å˜é‡ä¹‹å‰çš„å€¼ã€‚ä¾‹å¦‚ï¼š

```rust
let mut s = "Govinda".to_string();
s = "Siddhartha".to_string(); // å€¼"Govinda"åœ¨è¿™é‡Œ drop
```

Rust åœ¨å‡ ä¹æ‰€æœ‰åœºæ™¯ä¸‹éƒ½ä½¿ç”¨ moveã€‚å‘å‡½æ•°ä¼ å‚ä¼šæŠŠæ‰€æœ‰æƒç§»åŠ¨ç»™å‡½æ•°çš„å‚æ•°ï¼›ä»å‡½æ•°è¿”å›å€¼ä¼šæŠŠæ‰€æœ‰æƒç§»åŠ¨ç»™è°ƒç”¨è€…ï¼›åˆ›å»ºä¸€ä¸ªå…ƒç»„ä¼šæŠŠå€¼ç§»åŠ¨ç»™å…ƒç»„ï¼Œç­‰ç­‰ã€‚

```
struct Person { name: String, birth: i32 }
let mut composers = Vec::new();
composers.push(Person { name: "Palestrina".to_string(),
birth: 1525 });
```

#### ç§»åŠ¨ä¸æ§åˆ¶æµ

å¦‚æœä¸€ä¸ªå˜é‡åœ¨if è¡¨è¾¾å¼çš„æ¡ä»¶åˆ¤æ–­ä¹‹åè¿˜æ˜¯æœ‰å€¼çš„ï¼Œé‚£æˆ‘ä»¬åœ¨ä¸¤ä¸ªåˆ†æ”¯ä¸­éƒ½å¯ä»¥ä½¿ç”¨å®ƒï¼š

```rust
let x = vec![10, 20, 30];
if c {
    f(x); // ... åœ¨è¿™é‡Œç§»åŠ¨ xçš„å€¼æ˜¯ okçš„
} else {
    g(x); // ... åœ¨è¿™é‡Œç§»åŠ¨ xçš„å€¼æ˜¯ okçš„
}
h(x); // è¿™é‡Œ x ä¸èƒ½å†ä½¿ç”¨ï¼Œå› ä¸ºå®ƒå·²ç»è¢«ç§»åŠ¨äº†
```

å‡ºäºç±»ä¼¼çš„åŸå› ï¼Œåœ¨å¾ªç¯é‡Œç§»åŠ¨ä¸€ä¸ªå˜é‡çš„å€¼æ˜¯ç¦æ­¢çš„ï¼š

```rust
let x = vec![10, 20, 30];
while f() { 
    g(x); // é”™è¯¯ï¼šxä¼šåœ¨ç¬¬ä¸€æ¬¡è¿­ä»£æ—¶è¢«ç§»åŠ¨
}
``` 

#### ç§»åŠ¨ä¸ç´¢å¼•

æˆ‘ä»¬å·²ç»æåˆ°è¿‡ç§»åŠ¨ä¼šå°†æºå¯¹è±¡è®¾ç½®ä¸ºæœªåˆå§‹åŒ–çŠ¶æ€ï¼Œç›®çš„å¯¹è±¡ä¼šè·å¾—å€¼çš„æ‰€æœ‰æƒã€‚
ä½†å¹¶ä¸æ˜¯æ¯ä¸€ç§å€¼çš„æ‰€æœ‰è€…éƒ½å¯ä»¥è®¾ç½®ä¸ºæœªåˆå§‹åŒ–çŠ¶æ€ã€‚

```rust
let mut v = Vec::new();
for i in 101 .. 106 { 
    v.push(i.to_string());
}

let third = v[2];  // // é”™è¯¯ï¼šä¸èƒ½ç§»åŠ¨ Vec çš„ç´¢å¼•
// let third = &v[2];  // æ­£ç¡®ï¼šä½¿ç”¨å¼•ç”¨
println!("The third element is {}", third);

// error[E0507]: cannot move out of index of `Vec<String>`
// |
// 14 | let third = v[2];
// | ^^^^
// | | | move occurs because value has type `String`,
// | which does not implement the `Copy` trait
// | help: consider borrowing here: `&v[2]`
```

æœ‰ä¸‰ç§æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

```
// åˆ›å»ºä¸€ä¸ª stringçš„ vectorï¼š"101", "102", ... "105"
let mut v = Vec::new();
    for i in 101 .. 106 { v.push(i.to_string());
}

// 1. å¼¹å‡º vectorå°¾éƒ¨çš„å…ƒç´ 
let fifth = v.pop().expect("vector empty!");
assert_eq!(fifth, "105");

// 2. ç§»å‡ºç»™å®šä½ç½®çš„å…ƒç´ ï¼Œå¹¶æŠŠæœ€åä¸€ä¸ªå…ƒç´ ç§»åŠ¨è¿‡æ¥ï¼š
let second = v.swap_remove(1);
assert_eq!(second, "102");

// 3. ç”¨å¦ä¸€ä¸ªå€¼å’Œæˆ‘ä»¬æƒ³ç§»å‡ºçš„å€¼äº¤æ¢
let third = std::mem::replace(&mut v[2], "substitute".to_string());
assert_eq!(third, "103");

// è®©æˆ‘ä»¬çœ‹çœ‹ vectorä¸­è¿˜å‰©ä¸‹ä»€ä¹ˆã€‚
assert_eq!(v, vec!["101", "104", "substitute"]);
```

è¿™ä¸‰ç§æ–¹æ³•éƒ½ä» vectorä¸­ç§»å‡ºä¸€ä¸ªå…ƒç´ ï¼Œä½†ä»ç„¶ä¿è¯ vectorå¤„äºæ²¡æœ‰ç©ºéš™çš„çŠ¶æ€ï¼Œå¯èƒ½é•¿
åº¦è¿˜ä¼šå˜å°ã€‚

### Copy ç±»å‹

å¯¹äºç®€å•ç±»å‹ä¾‹å¦‚æ•´æ•°æˆ–å­—ç¬¦ï¼Œç§»åŠ¨å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œè¿™äº›ç±»å‹è¢«ç§°ä¸º Copy ç±»å‹ã€‚

```rust
let string1 = "somnambulance".to_string();
let string2 = string1;

let num1: i32 = 36;
let num2 = num1;

```

Rust èµ‹äºˆä¸€ä¸ª Copy ç±»å‹çš„å€¼ä¼šæ‹·è´å®ƒï¼Œè€Œä¸æ˜¯ç§»åŠ¨å®ƒã€‚

<img src="/images/copy.png" alt="copy" width="650">

æ ‡å‡†çš„ Copy ç±»å‹åŒ…æ‹¬æ‰€æœ‰çš„æœºå™¨æ•´æ•°å’Œæµ®ç‚¹æ•°ç±»å‹ã€char å’Œ bool ç±»å‹ï¼Œä»¥åŠå°‘æ•°å…¶ä»–ç±»
å‹ã€‚æ‰€æœ‰å…ƒç´ éƒ½æ˜¯ Copy ç±»å‹çš„å…ƒç»„æˆ–æ•°ç»„ä¹Ÿæ˜¯ Copy ç±»å‹ã€‚


### Rc å’Œ Arcï¼šå…±äº«æ‰€æœ‰æƒ

Rustæä¾›äº†å¼•ç”¨è®¡æ•°ç±»å‹ Rc å’Œ Arcã€‚Rc å’Œ Arc ç±»å‹éå¸¸ç›¸ä¼¼ï¼Œå®ƒä»¬å”¯ä¸€çš„ä¸åŒä¹‹å¤„åœ¨äº Arc å¯ä»¥ç›´æ¥å®‰å…¨åœ°åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œåç§° Arc æ˜¯åŸå­å¼•ç”¨è®¡æ•°çš„ç¼©å†™ï¼ŒRc åˆ™ä½¿ç”¨æ›´å¿«ä¸€äº›çš„éçº¿ç¨‹å®‰å…¨ä»£ç æ¥æ›´æ–°å¼•ç”¨è®¡æ•°ã€‚

å¯ä»¥ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥ç®¡ç†å€¼çš„ç”Ÿå­˜å‘¨æœŸï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ç¨‹åºçš„å¤šä¸ªéƒ¨åˆ†ä¹‹é—´å…±äº«å€¼çš„æ‰€æœ‰æƒã€‚

```rust
use std::rc::Rc;

// Rustå¯ä»¥æ¨æ–­å‡ºæ‰€æœ‰è¿™äº›ç±»å‹ï¼Œå†™å‡ºæ¥æ˜¯ä¸ºäº†æ›´æ¸…æ¥š
let s: Rc<String> = Rc::new("shirataki".to_string());
let t: Rc<String> = s.clone();
let u: Rc<String> = s.clone();
```

å¯¹äºä»»æ„ç±»å‹ Tï¼Œä¸€ä¸ª Rc<T> å€¼æ˜¯ä¸€ä¸ªæŒ‡å‘åœ¨å †ä¸Šåˆ†é…çš„ T ç±»å‹å€¼çš„æŒ‡é’ˆï¼ŒåŒæ—¶è¿˜é™„æœ‰ä¸€
ä¸ªå¼•ç”¨è®¡æ•°ã€‚å…‹éš†ä¸€ä¸ªRc<T> ç±»å‹çš„å€¼å¹¶ä¸æ„å‘³ç€æ‹·è´ Tï¼Œå®ƒåªæ˜¯ç®€å•çš„åˆ›å»ºå¦ä¸€ä¸ªæŒ‡å‘å®ƒçš„
æŒ‡é’ˆï¼Œå¹¶ä¸”é€’å¢å¼•ç”¨è®¡æ•°ã€‚

<img src="/images/rc.png" alt="rc" width="650">

è¿™ä¸‰ä¸ª Rc<String> æŒ‡é’ˆéƒ½æŒ‡å‘å†…å­˜ä¸­çš„åŒä¸€å—å†…å­˜ï¼Œè¿™å—å†…å­˜é‡Œå­˜å‚¨äº†ä¸€ä¸ªå¼•ç”¨è®¡æ•°å’Œä¸€ä¸ª Stringã€‚é€šå¸¸çš„æ‰€æœ‰æƒè§„ä¹Ÿé€‚ç”¨äº Rc æŒ‡é’ˆï¼Œå½“æœ€åä¸€ä¸ª Rc æŒ‡é’ˆ drop æ—¶ï¼ŒRustä¼šåŒæ—¶ drop æ‰ Stringã€‚


## å¼•ç”¨ 

å¼•å…¥å¼•ç”¨å°±æ˜¯ä¸ºäº†è§£å†³æ‰€æœ‰æƒç¦æ­¢å…±äº«çš„é—®é¢˜ï¼Œå¼•ç”¨æ˜¯ä¸€ç§ç±»å‹ï¼Œå€Ÿç”¨æ˜¯åŠ¨ä½œã€‚


## ç”Ÿå‘½å‘¨æœŸ

### ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨

å¼•å…¥ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ï¼Œæ˜¯ä¸ºäº†è§£å†³ç¼–è¯‘å™¨éœ€è¦èƒ½å¤Ÿæ£€æµ‹ä»£ç ä¸­æ˜¯å¦å­˜åœ¨æ‚¬å‚å¼•ç”¨çš„é£é™©ï¼Œå¹¶åœ¨æ£€æµ‹åˆ°æ­¤ç±»é£é™©æ—¶æ‹’ç»ç¼–è¯‘ã€‚

é€šè¿‡ç»å…¸çš„ longest å‡½æ•°æ¥äº†è§£ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨çš„ç”¨å¤„ï¼š

```rust
fn longest(x: &str, y: &str) -> &str {
    if x.len() > y.len() {
        x
    } else {
        y
    }
}
```

è¿™æ®µä»£ç ä¼šç¼–è¯‘æŠ¥é”™çš„ï¼Œå› ä¸ºè¿”å›çš„å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸ç¡®å®šçš„ï¼Œç¼–è¯‘å™¨æ— æ³•ç¡®å®šè¿”å›çš„å¼•ç”¨å’Œ x è¿˜æ˜¯ y å…³è”ã€‚

```rust
fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
    if x.len() > y.len() {
        x
    } else {
        y
    }
}
```

å¢åŠ äº†ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨åï¼Œä»£ç å¯ä»¥æ­£ç¡®ç¼–è¯‘ã€‚æ ‡æ³¨ `â€™a` å®é™…ä¸Šæ˜¯åœ¨å‘Šè¯‰ç¼–è¯‘å™¨ä¸€ä¸ªä¿¡æ¯ï¼š

* `'a` æŒ‡å‡ºè¿”å›çš„å¼•ç”¨ä¸è¾“å…¥å‚æ•°xï¼Œyä¹‹é—´æœ‰å…³è”ï¼›

* `'a` åªæ˜¯å…³è”å…³ç³»çš„ä»£å·ï¼›

```rust
fn largest<T: std::cmp::PartialOrd>(list: &[T]) -> &T {
    let mut largest:&T = &list[0];

    for item in list.iter() {
        if item > largest {
            largest = item;
        }
    }

    largest
}

fn main() {
    let number_list = vec![34, 50, 25, 100, 65];

    let result = largest(&number_list);
    println!("The largest number is {}", result);

    let char_list = vec!['y', 'm', 'a', 'q'];

    let result = largest(&char_list);
    println!("The largest char is {}", result);
}

// The largest number is 100
// The largest char is y
```

## ç‰¹å‹å’Œæ³›å‹

æ³›å‹æ˜¯ `Rust` ä¸­å¦ä¸€ç§å½¢å¼çš„å¤šæ€ã€‚ç±»ä¼¼äº `C++` çš„æ¨¡æ¿ï¼Œæ³›å‹å‡½æ•°æˆ–æ³›å‹ç±»å‹å¯ä»¥å’Œä¸åŒç±»å‹çš„å€¼ä¸€èµ·ä½¿ç”¨ï¼š

```
fn min<T: Ord>(value1: T, value2: T) -> T {
    if value1 <= value2 {
        value1
    } else {
        value2
    } 
}

fn main() {
    let a = 10;
    let b = 20;
    let c = min(a, b);
    println!("The minimum value is: {}", c);
}
```

æ­¤å‡½æ•°ä¸­çš„ `<T: Ord>` æ„å‘³ç€ `min` å‡½æ•°å¯ä»¥äºå®ç°äº† `Ord` ç‰¹å‹çš„ä»»æ„ç±»å‹ï¼ˆä»»æ„æœ‰åºç±»å‹ï¼‰`T` çš„å‚æ•°ä¸€èµ·ä½¿ç”¨ã€‚
åƒè¿™æ ·çš„è¦æ±‚è¢«ç§°ä¸ºç•Œé™ï¼ˆboundsï¼‰ï¼Œå®ƒå¯¹ `T` å¯èƒ½çš„ç±»å‹èŒƒå›´åšäº†é™åˆ¶ã€‚ç¼–è¯‘å™¨ä¼šé’ˆå¯¹ä½ å®é™…ä½¿ç”¨åˆ°çš„æ¯ä¸€ä¸ªç±»å‹ `T` ç”Ÿæˆä¸€ä»½å•ç‹¬çš„æœºå™¨ç ã€‚

### ä½¿ç”¨ç‰¹å‹

ç‰¹å‹ä»£è¡¨ä¸€ç§èƒ½åŠ›ï¼Œå³ä¸€ä¸ªç±»å‹èƒ½åšä»€ä¹ˆã€‚

ç‰¹å‹æ–¹æ³•æœ‰ä¸€æ¡éœ€è¦æ³¨æ„çš„è§„åˆ™ï¼šç‰¹å‹æœ¬èº«å¿…é¡»åœ¨ä½œç”¨åŸŸå†…ï¼Œå¦åˆ™ï¼Œå®ƒçš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯ä¸å¯è§çš„ã€‚

```rust
fn main() {
    let mut buf: Vec<u8> = vec![];
    buf.write_all(b"hello")?; // é”™è¯¯ï¼šæ²¡æœ‰å«`write_all`çš„æ–¹æ³•
}
```

ä¿®å¤è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯åœ¨ä½œç”¨åŸŸä¸­å¼•å…¥ `std::io::Write` ç‰¹å‹ï¼š

```rust
use std::io::Write;

fn main() {
    let mut buf: Vec<u8> = vec![];
    buf.write_all(b"hello")?; // é”™è¯¯ï¼šæ²¡æœ‰å«`write_all`çš„æ–¹æ³•
}
```

`Clone` å’Œ `Iterator` çš„æ–¹æ³•ä¸éœ€è¦ç‰¹æ®Šçš„å¯¼å…¥æ˜¯å› ä¸ºå®ƒä»¬é»˜è®¤æ€»æ˜¯åœ¨ä½œç”¨åŸŸé‡Œï¼šå®ƒä»¬æ˜¯æ ‡å‡†åº“é¢„å¯¼å…¥çš„ä¸€éƒ¨åˆ†ã€‚

#### ç‰¹å‹å¯¹è±¡

åœ¨ Rust ä¸­ä½¿ç”¨ç‰¹å‹ç¼–å†™å¤šæ€ä»£ç æœ‰ä¸¤ç§æ–¹æ³•ï¼šç‰¹å‹å¯¹è±¡å’Œæ³›å‹ã€‚æ¥ä¸‹æ¥å…ˆä»‹ç»ç‰¹å‹å¯¹è±¡ã€‚

```rust
fn main() {
    let mut buf: Vec<u8> = vec![];

    let writer: &mut dyn Write = &mut buf; // ok
}
```

å¯¹ç‰¹å‹å¯¹è±¡ï¼ˆå¦‚ writerï¼‰çš„å¼•ç”¨å«ä½œç‰¹å‹å¯¹è±¡ã€‚ä¸å…¶ä»–å¼•ç”¨ä¸€æ ·ï¼Œç‰¹å‹å¯¹è±¡æŒ‡å‘æŸä¸ªå€¼ã€å®ƒæœ‰ç”Ÿå‘½å‘¨æœŸã€å®ƒå¯ä»¥æ˜¯å¯å˜çš„æˆ–è€…æ˜¯å…±äº«çš„ã€‚

åœ¨å†…å­˜ä¸­ï¼Œç‰¹å‹å¯¹è±¡æ˜¯ä¸€ä¸ªèƒ–æŒ‡é’ˆï¼Œç”±æŒ‡å‘å€¼çš„æŒ‡é’ˆå’ŒæŒ‡å‘è¯¥å€¼ç±»å‹çš„è™šè¡¨æŒ‡é’ˆç»„æˆã€‚

<img src="/images/trait-mem.png" alt="trait-mem" width="650">

Rust ä¼šåœ¨éœ€è¦æ—¶è‡ªåŠ¨å°†æ™®é€šå¼•ç”¨è½¬æ¢ä¸ºç‰¹å‹å¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å«ä½œéšå¼è½¬æ¢ã€‚

```rust
use std::io::Write;
use std::fs::File;

fn say_hello(out: &mut dyn Write) -> std::io::Result<()> {
    out.write_all(b"hello world\n")?;
    out.flush()
}

fn main() {
    let mut local_file = File::create("hello.txt")?;
    say_hello(&mut local_file)?;

    let mut bytes = vec![];
    say_hello(&mut bytes)?;
}
```

`&mut local_file` çš„ç±»å‹æ˜¯ `&mut File`ï¼Œè€Œ `say_hello` çš„å‚æ•°ç±»å‹æ˜¯ `&mut dyn Write`ã€‚
å› ä¸º `File` æ˜¯ä¸€ç§å†™å…¥å™¨ï¼Œå› æ­¤ Rust å…è®¸å°†è¿™ç§æ™®é€šå¼•ç”¨è½¬æ¢ä¸ºç‰¹å‹å¯¹è±¡ã€‚

åŒæ ·çš„ï¼ŒRustä¹Ÿä¹äºæŠŠ Box<File> è½¬æ¢æˆ Box<dyn Write>ï¼Œå®ƒæ‹¥æœ‰ä¸€ä¸ªåœ¨å †ä¸Šçš„å†™å…¥å™¨ï¼š

```rust
let w: Box<dyn Write> = Box::new(local_file);
```

`Box<dyn Write>` å’Œ `&mut dyn Write` ä¸€æ ·æ˜¯ä¸€ä¸ªèƒ–æŒ‡é’ˆï¼Œå®ƒåŒ…å«å†™å…¥å™¨è‡ªèº«çš„åœ°å€å’Œè™šè¡¨çš„åœ°å€ã€‚å…¶ä»–æŒ‡é’ˆç±»å‹ä¾‹å¦‚ `Rc<dyn Write>` ä¹Ÿä¸€æ ·ã€‚

è¿™ç§è½¬æ¢æ˜¯å”¯ä¸€åˆ›å»ºç‰¹å‹å¯¹è±¡çš„å”¯ä¸€æ–¹æ³•ã€‚ç¼–è¯‘å™¨åšçš„å·¥ä½œå…¶å®å¾ˆç®€å•ï¼Œå½“è½¬æ¢å‘ç”Ÿæ—¶ï¼Œ
Rust çŸ¥é“è¢«å¼•ç”¨å€¼çš„çœŸæ­£ç±»å‹ï¼ˆè¿™ä¸ªä¾‹å­ä¸­æ˜¯ Fileï¼‰ï¼Œå› æ­¤å®ƒåªæ˜¯åŠ ä¸Šäº†æ­£ç¡®çš„è™šè¡¨çš„åœ°å€ã€æŠŠæ™®é€šæŒ‡é’ˆå˜æˆäº†èƒ–æŒ‡é’ˆã€‚

#### æ³›å‹å‡½æ•°å’Œç±»å‹å‚æ•°

æŠŠä»¥å‡½æ•°ç‰¹å‹å¯¹è±¡ä¸ºå‚æ•°çš„å‡½æ•° `say_hello()` æ”¹å†™ä¸ºæ³›å‹å‡½æ•°ï¼š

```rust
use std::io::Write;
use std::fs::File;

fn say_hello<W: Write>(out: &mut W) -> std::io::Result<()> {
    out.write_all(b"hello world\n")?;
    out.flush()
}

fn main() {
    let mut local_file = File::create("hello.txt")?;
    say_hello(&mut local_file)?;

    let mut bytes = vec![];
    say_hello(&mut bytes)?;
}
```

çŸ­è¯­ `<W: Write>` æŠŠå‡½æ•°å˜æˆäº†æ³›å‹å½¢å¼ï¼Œæ­¤çŸ­è¯­å«ä½œç±»å‹å‚æ•°ã€‚

Rust ä¼šä¸º `say_hello()` ç”Ÿæˆä¸¤ä¸ªç‰ˆæœ¬çš„æœºå™¨ç ï¼Œä¸€ä¸ªæ˜¯ `File` ç‰ˆæœ¬ï¼Œå¦ä¸€ä¸ªæ˜¯ `Vec<u8>` ç‰ˆæœ¬ã€‚
Rust ä¼šä»å‚æ•°çš„ç±»å‹æ¨å¯¼å‡ºç±»å‹ Wï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºå•æ€åŒ–ã€‚

æ³›å‹å‡½æ•°å¯ä»¥æœ‰å¤šä¸ªç±»å‹å‚æ•°ï¼š

```rust
fn run_query<M: Mapper + Serialize, R: Reducer + Serialize>(
        data: &DataSet, map: M, reduce: R) -> Results
{ ... }
```

æ­£å¦‚è¿™ä¸ªä¾‹å­å±•ç¤ºçš„ä¸€æ ·ï¼Œçº¦æŸå¯èƒ½å¤ªé•¿ä»¥è‡³äºå¾ˆéš¾é˜…è¯»ã€‚Rustæä¾›äº†ä½¿ç”¨å…³é”®å­— where çš„æ›¿ä»£è¯­æ³•ï¼š

```rust
fn run_query<M, R>(data: &DataSet, map: M, reduce: R) -> Results
    where M: Mapper + Serialize, 
          R: Reducer + Serialize
{ ... }
```

å¼•ç”¨ä½œä¸ºå‡½æ•°å‚æ•°ä»‹ç»äº†ç”Ÿå‘½å‘¨æœŸçš„è¯­æ³•ã€‚ä¸€ä¸ªæ³›å‹å‡½æ•°å¯ä»¥åŒæ—¶æœ‰ç”Ÿå‘½å‘¨æœŸå‚æ•°å’Œç±»å‹å‚æ•°ã€‚ç”Ÿå‘½å‘¨æœŸå‚æ•°åœ¨å‰ï¼š

```rust
fn nearest<'t, 'c, P>(target: &'t P, candidates: &'c [P]) -> &'c P
    where P: MeasureDistance
{
    ... 
}
```

#### ä½¿ç”¨å“ªä¸€ä¸ªï¼Ÿ

æ³›å‹å‡½æ•°çš„åŠ£åŠ¿åœ¨äºï¼ŒRust ä¼šä¸ºæ¯ç§ç”¨åˆ°çš„ç±»å‹éƒ½ç¼–è¯‘ä¸€æ¬¡ï¼Œç”Ÿæˆä¸€ä»½æœºå™¨ç ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´äºŒè¿›åˆ¶æ–‡ä»¶å˜å¤§ã€‚

ä½†æ³›å‹ç›¸å½“äºç‰¹å‹å¯¹è±¡çš„ä¼˜åŠ¿åœ¨äºï¼š

* æ³›å‹æ‰§è¡Œé€Ÿåº¦æ›´å¿«ï¼Œåœ¨ç¼–è¯‘æœŸé—´å°±èƒ½ç¡®å®šç±»å‹ï¼Œä¸éœ€è¦è¿è¡Œæ—¶çš„è™šæ–¹æ³•çš„è°ƒç”¨å¼€é”€å’Œæ£€æŸ¥é”™è¯¯çš„å¼€é”€ï¼›

* æ³›å‹ç¬¬äºŒä¸ªä¼˜åŠ¿åœ¨äºå¹¶ä¸æ˜¯æ¯ä¸ªç±»å‹éƒ½æ”¯æŒç‰¹å‹å¯¹è±¡ï¼Œç‰¹å‹æ”¯æŒçš„å‡ ä¸ªç‰¹æ€§ï¼ˆä¾‹å¦‚å…³è”å‡½æ•°ï¼‰åªé€‚ç”¨äºæ³›å‹ï¼š
å®ƒä»¬å®Œå…¨ä¸æ”¯æŒç‰¹å‹å¯¹è±¡ã€‚

* æ³›å‹çš„ç¬¬ä¸‰ä¸ªä¼˜åŠ¿æ˜¯å¯ä»¥å¾ˆå®¹æ˜“åœ°ä¸€æ¬¡ç»™æ³›å‹ç±»å‹å‚æ•°æ·»åŠ å¤šä¸ªç‰¹å‹çº¦æŸï¼Œä¾‹å¦‚
æˆ‘ä»¬çš„ `top_ten` å‡½æ•°å°±è¦æ±‚å®ƒçš„å‚æ•° `T` è¦å®ç° `Debug + Hash + Eq`ã€‚ç‰¹å‹å¯¹è±¡ä¸èƒ½è¿™ä¹ˆåšï¼š
Rust ä¸æ”¯æŒç±»ä¼¼ `&mut (dyn Debug + Hash + Eq)` è¿™æ ·çš„ç±»å‹ã€‚




#### å®šä¹‰ç‰¹å¾

å¦‚æœä¸åŒçš„ç±»å‹å…·æœ‰ç›¸åŒçš„è¡Œä¸ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªç‰¹å¾ï¼Œç„¶åä¸ºè¿™äº›ç±»å‹å®ç°è¯¥ç‰¹å¾

```rust
pub trait Summary {
    fn summarize(&self) -> String;
}
```

è¿™é‡Œä½¿ç”¨ `trait` å…³é”®å­—æ¥å£°æ˜ä¸€ä¸ªç‰¹å¾ï¼Œ`Summary` æ˜¯ç‰¹å¾åã€‚åœ¨å¤§æ‹¬å·ä¸­å®šä¹‰äº†è¯¥ç‰¹å¾çš„æ‰€æœ‰æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ï¼š `fn summarize(&self) -> String`ã€‚

ç‰¹å¾åªå®šä¹‰è¡Œä¸ºçœ‹èµ·æ¥æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œè€Œä¸å®šä¹‰è¡Œä¸ºå…·ä½“æ˜¯æ€ä¹ˆæ ·çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªå®šä¹‰ç‰¹å¾æ–¹æ³•çš„ç­¾åï¼Œè€Œä¸è¿›è¡Œå®ç°ï¼Œæ­¤æ—¶æ–¹æ³•ç­¾åç»“å°¾æ˜¯ ;ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª {}ã€‚

#### ä¸ºç±»å‹å®ç°ç‰¹å¾

å®ç°ç‰¹å¾çš„è¯­æ³•ä¸ä¸ºç»“æ„ä½“ã€æšä¸¾å®ç°æ–¹æ³•å¾ˆåƒï¼š`impl Summary for Post`ï¼Œè¯»ä½œ"ä¸º `Post` ç±»å‹å®ç° `Summary` ç‰¹å¾"ï¼Œ
ç„¶ååœ¨ `impl` çš„èŠ±æ‹¬å·ä¸­å®ç°è¯¥ç‰¹å¾çš„å…·ä½“æ–¹æ³•ã€‚

```rust
pub trait Summary {
    fn summarize(&self) -> String;
}
pub struct Post {
    pub title: String, // æ ‡é¢˜
    pub author: String, // ä½œè€…
    pub content: String, // å†…å®¹
}

impl Summary for Post {
    fn summarize(&self) -> String {
        format!("æ–‡ç« {}, ä½œè€…æ˜¯{}", self.title, self.author)
    }
}

fn main() {
    let post = Post{title: "Rustè¯­è¨€ç®€ä»‹".to_string(),
            author: "Sunface".to_string(), content: "Rustæ£’æäº†!".to_string()};
    println!("{}",post.summarize());
}
```

**é»˜è®¤å®ç°**

ä½ å¯ä»¥åœ¨ç‰¹å¾ä¸­å®šä¹‰å…·æœ‰é»˜è®¤å®ç°çš„æ–¹æ³•ï¼Œè¿™æ ·å…¶å®ƒç±»å‹æ— éœ€å†å®ç°è¯¥æ–¹æ³•ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥é€‰æ‹©é‡è½½è¯¥æ–¹æ³•ã€‚

```rust
pub trait Summary {
    fn summarize(&self) -> String {
        String::from("(Read more...)")
    }
}

pub struct Weibo {
    pub username: String,
    pub content: String
}

impl Summary for Weibo {}

fn main() {
    let weibo = Weibo{username: "sunface".to_string(),
        content: "å¥½åƒå¾®åšæ²¡Tweetå¥½ç”¨".to_string()};
    println!("{}",weibo.summarize());
}
```

**å­¤å„¿è§„åˆ™**

å…³äºç‰¹å¾å®ç°ä¸å®šä¹‰çš„ä½ç½®ï¼Œæœ‰ä¸€æ¡éå¸¸é‡è¦çš„åŸåˆ™ï¼šå¦‚æœä½ æƒ³è¦ä¸ºç±»å‹ A å®ç°ç‰¹å¾ Tï¼Œé‚£ä¹ˆ A æˆ–è€… T è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯åœ¨å½“å‰ä½œç”¨åŸŸä¸­å®šä¹‰çš„ã€‚

#### ç‰¹å¾ä½œä¸ºå‡½æ•°å‚æ•°

å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨ç‰¹å¾ä½œä¸ºå‡½æ•°å‚æ•°:

```rust
pub fn notify(item: &impl Summary) {
    println!("Breaking news! {}", item.summarize());
}
```

`impl Summary`ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒçš„æ„æ€æ˜¯ å®ç°äº† `Summary` ç‰¹å¾ çš„ `item` å‚æ•°ã€‚

#### ç‰¹å¾çº¦æŸ

è™½ç„¶ `impl Trait` è¿™ç§è¯­æ³•éå¸¸å¥½ç†è§£ï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼š

```rust
pub fn notify<T: Summary>(item: &T) {
    println!("Breaking news! {}", item.summarize());
}
```

çœŸæ­£çš„å®Œæ•´ä¹¦å†™å½¢å¼å¦‚ä¸Šæ‰€è¿°ï¼Œå½¢å¦‚ `T: Summary` è¢«ç§°ä¸ºç‰¹å¾çº¦æŸã€‚

```rust
pub fn notify(item1: &impl Summary, item2: &impl Summary) {}

pub fn notify<T: Summary>(item1: &T, item2: &T) {}
```

å¯¹äºå¤æ‚çš„åœºæ™¯ï¼Œç‰¹å¾çº¦æŸå¯ä»¥è®©æˆ‘ä»¬æ‹¥æœ‰æ›´å¤§çš„çµæ´»æ€§å’Œè¯­æ³•è¡¨ç°èƒ½åŠ›ã€‚

**å¤šé‡çº¦æŸ**

é™¤äº†å•ä¸ªçº¦æŸæ¡ä»¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šå¤šä¸ªçº¦æŸæ¡ä»¶ã€‚

```rust
pub fn notify(item: &(impl Summary + Display)) {}

pub fn notify<T: Summary + Display>(item: &T) {}
```

**Where çº¦æŸ**

å½“ç‰¹å¾çº¦æŸå˜å¾—å¾ˆå¤šæ—¶ï¼Œå‡½æ•°çš„ç­¾åå°†å˜å¾—å¾ˆå¤æ‚ï¼š

```rust
fn some_function<T: Display + Clone, U: Clone + Debug>(t: &T, u: &U) -> i32 {}
```

ä¸¥æ ¼æ¥è¯´ï¼Œä¸Šé¢çš„ä¾‹å­è¿˜æ˜¯ä¸å¤Ÿå¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯èƒ½å¯¹å…¶åšä¸€äº›å½¢å¼ä¸Šçš„æ”¹è¿›ï¼Œé€šè¿‡ whereï¼š

```rust
fn some_function<T, U>(t: &T, u: &U) -> i32
    where T: Display + Clone,
          U: Clone + Debug
{}
```

### ç‰¹å¾å¯¹è±¡

å¯ä»¥é€šè¿‡ `&` å¼•ç”¨æˆ–è€… `Box<T>` æ™ºèƒ½æŒ‡é’ˆçš„æ–¹å¼æ¥åˆ›å»ºç‰¹å¾å¯¹è±¡ã€‚

```rust
trait Draw {
    fn draw(&self) -> String;
}

impl Draw for u8 {
    fn draw(&self) -> String {
        format!("u8: {}", *self)
    }
}

impl Draw for f64 {
    fn draw(&self) -> String {
        format!("f64: {}", *self)
    }
}

fn draw1(x: Box<impl Draw>) -> String {
     x.draw()
}

fn draw2(x: &dyn Draw) -> String {
    x.draw()
}

fn main() {
    let x = 1.1f64;
    let y = 8u8;

    // Box<T> åˆ›å»ºç‰¹å¾å¯¹è±¡
    draw1(Box::new(x));
    draw1(Box::new(y));
    
    // & å¼•ç”¨ åˆ›å»ºç‰¹å¾å¯¹è±¡
    draw2(&x);
    draw2(&y);

    println!("{}", draw2(&x));
    println!("{}", draw2(&y));
}
```

#### åŠ¨æ€åˆ†å‘








## ç›¸å…³é“¾æ¥

[crates.io](https://crates.io/)
[The Rust Edition Guide](https://doc.rust-lang.org/edition-guide/)
[æ ‡å‡†é¡¹ç›®ç›®å½•ç»“æ„](https://course.rs/cargo/guide/package-layout.html)
[å˜æ›´é•œåƒåœ°å€](https://course.rs/first-try/slowly-downloading.html)
